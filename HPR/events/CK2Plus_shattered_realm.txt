namespace = Plus

#reserved: Plus.1450 to Plus.1499

#######################################
# SHATTERED REALM EVENTS
#######################################
		
#Makes everyone an independent count, creating titles where needed
character_event = {
	id = Plus.1450
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		set_global_flag = shattered_realm
		any_independent_ruler = {
			limit = {
				primary_title = { is_primary_type_title = no } # Prevent it from targeting Mercenaries, Holy Orders and Religious Leaders
				is_nomadic = no
			}
			any_war = { end_war = invalid }
			disband_event_forces = yes # Don't want event troops stomping around
			any_realm_lord = {
				limit = {
					higher_tier_than = baron
				}
				any_war = { end_war = invalid }
				any_demesne_title = {
					limit = {
						higher_tier_than = count
					}
					destroy_landed_title = THIS
				}
				any_demesne_title = {
					limit = { # Don't do this to players unless they have more than 1 county
						holder_scope = { 
							OR = {
								ai = yes 
								num_of_count_titles = 2
							}
						}
						higher_tier_than = baron
					}
					create_character = {
						random_traits = yes
						religion = THIS
						culture = THIS
						age = 16
					}
					new_character = {
						usurp_title_plus_barony_if_unlanded = PREV
						set_defacto_liege = THIS
					}
				}
				any_claim = {
					PREV = { remove_claim = PREV }
				}
				any_courtier = {
					any_claim = {
						PREV = { remove_claim = PREV }
					}
				}
			}
			any_demesne_title = {
				limit = {
					higher_tier_than = count
				}
				destroy_landed_title = THIS
			}
			any_demesne_title = {
				limit = {
					tier = count
					location = { is_capital = no }
				}
				create_character = {
					random_traits = yes
					religion = THIS
					culture = THIS
					age = 16
				}
				new_character = {
					usurp_title_plus_barony_if_unlanded = PREV
					set_defacto_liege = THIS
					primary_title = {
					}
				}
			}
			# This removes all claims from landholders
			any_claim = {
				remove_claim = PREV
			}
			# This removes all claims from courtiers
			any_courtier = {
				any_claim = {
					remove_claim = PREV
				}
			}
		}
		any_independent_ruler = {
			limit = {
				primary_title = { is_primary_type_title = no } # Prevent it from targeting Mercenaries, Holy Orders and Religious Leaders
				is_nomadic = yes
			}
			any_war = { end_war = invalid }
			disband_event_forces = yes # Don't want event troops stomping around
			#Create New Nomad
			capital_scope = {
				create_title = {
					tier = EMPEROR
					landless = yes
					culture = PREV
					name = "SHATTERED_REALM_KHAGANATE"
					holder = PREV
					base_title = THIS
					dynasty_title_names = no
				}
			}
			any_realm_province = {
				any_province_holding = {
					if = {
						limit = {
							NOT = { holding_type = nomad }
						}
						destroy_settlement = THIS
					}
				}
			}
			if = {
				limit = {
					has_dlc = "Horse Lords"
				}
				set_government_type = nomadic_government
			}
			if = {
				limit = {
					NOT = { has_dlc = "Horse Lords" }
				}
				set_government_type = tribal_government
			}
			any_realm_lord = {
				limit = {
					higher_tier_than = baron
				}
				set_defacto_liege = THIS
				any_war = { end_war = invalid }
				any_demesne_title = {
					limit = {
						higher_tier_than = count
					}
					destroy_landed_title = THIS
				}
				any_demesne_title = {
					limit = { # Don't do this to players unless they have more than 1 county
						holder_scope = { 
							OR = {
								ai = yes 
								num_of_count_titles = 2
							}
						}
						higher_tier_than = baron
					}
					create_character = {
						random_traits = yes
						religion = THIS
						culture = THIS
						age = 16
					}
					new_character = {
						usurp_title_plus_barony_if_unlanded = PREV
						set_defacto_liege = THIS					
						if = {
							limit = {
								has_dlc = "Horse Lords"
							}
							set_government_type = nomadic_government
						}
						if = {
							limit = {
								NOT = { has_dlc = "Horse Lords" }
							}
							set_government_type = tribal_government
						}						
					}
				}
				any_claim = {
					PREV = { remove_claim = PREV }
				}
				any_courtier = {
					any_claim = {
						PREV = { remove_claim = PREV }
					}
				}
			}
			any_demesne_title = {
				limit = {
					higher_tier_than = count
					NOT = {
						is_landless_type_title = yes
					}
				}
				destroy_landed_title = THIS
			}
			any_demesne_title = {
				limit = {
					tier = count
					location = { is_capital = no }
				}
				create_character = {
					random_traits = yes
					religion = THIS
					culture = THIS
					age = 16
				}
				new_character = {
					usurp_title_plus_barony_if_unlanded = PREV
					set_defacto_liege = THIS
					if = {
						limit = {
							has_dlc = "Horse Lords"
						}
						set_government_type = nomadic_government
					}
					if = {
						limit = {
							NOT = { has_dlc = "Horse Lords" }
						}
						set_government_type = tribal_government
					}					
				}
			}
			# This removes all claims from landholders
			any_claim = {
				remove_claim = PREV
				
			}
			# This removes all claims from courtiers
			any_courtier = {
				any_claim = {
					remove_claim = PREV
				}
			}
		}
	}
}

#Makes everyone an independent count, but assigning them specific religions
#(and in some cases cultures) dependent on geography
character_event = {
	id = Plus.1451
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		set_global_flag = reign_ancients
		any_independent_ruler = {
			limit = {
				primary_title = { is_primary_type_title = no } # Prevent it from targeting Mercenaries, Holy Orders and Religious Leaders
			}
			any_war = { end_war = invalid }
			disband_event_forces = yes # Don't want event troops stomping around
			any_realm_lord = {
				limit = {
					higher_tier_than = baron
				}
				any_war = { end_war = invalid }
				any_demesne_title = {
					limit = {
						higher_tier_than = count
					}
					destroy_landed_title = THIS
				}
				any_demesne_title = {
					limit = { # Don't do this to players unless they have more than 1 county
						holder_scope = { 
							OR = {
								ai = yes 
								num_of_count_titles = 2
							}
						}
						higher_tier_than = baron
					}				
					if = {
						limit = {
							location = {
								OR = {
									region = custom_france 
									region = custom_aquitaine 
									region = custom_aragon 
									region = custom_navarra 
									region = custom_castille 
									region = custom_asturias 
									region = custom_andalusia
									region = custom_ireland
									region = custom_brittany
									region = custom_scotland
									region = custom_portugal
									region = custom_wales
								}
							}
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = celtic_pagan
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}						
					}
					if = {
						limit = {
							location = { 
								OR = {
									region = custom_germany
									region = custom_frisia
									region = custom_lotharingia
									region = custom_burgundy
								}
							} 
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = german_pagan
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}						
					}					
					if = {
						limit = {
							OR = {
								location = {
									OR = {
										region = custom_croatia 
										region = custom_serbia 
										region = custom_bulgaria 
										region = custom_byzantium 
										region = custom_nikaea
										region = custom_trebizond
										region = custom_armenia
										region = custom_italy
										region = custom_sicily
										region = custom_georgia
									}
								}
								duchy = {
									title = d_carinthia
								}
							}
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = hellenic_pagan
							culture = roman
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}
					}
					if = {
						limit = {
							location = {
								OR = {
									region = custom_england 
									region = custom_norway 
									region = custom_sweden
									region = custom_denmark
								}
							}
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = norse_pagan
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}
					}
					if = {
						limit = {
							location = {
								OR = {
									region = custom_persia 
									region = custom_afghanistan 
									region = custom_baluchistan 
								}
							}
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = zoroastrian
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}
					}
					if = {
						limit = {
							location = {
								OR = {
									region = custom_finland
									region = custom_perm
								}
							}
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = finnish_pagan
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}
					}
					if = {
						limit = {
							location = {
								OR = {
									region = custom_cuman
									region = custom_wallachia
									region = custom_crimea
									region = custom_carpathia
									region = custom_volga		
								}
							}
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = tengri_pagan
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}
					}
					if = {
						limit = {
							location = {
								region = custom_azerbaijan
							}
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = messalian
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}
					}
					if = {
						limit = {
							location = {
								OR = {
									region = custom_baluchistan
									region = custom_afghanistan
								}
							}
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = zun_pagan
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}
					}						
					if = {
						limit = {
							location = {
								OR = {
									region = custom_poland
									region = custom_bohemia
									region = custom_pomerania
									region = custom_rus
									region = custom_muscovy
									region = custom_novgorod
								}
							}
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = slavic_pagan
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}
					}					
					if = {
						limit = {
							location = {
								region = custom_mesopotamia
							}
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = sunni
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}
					}
					if = {
						limit = {
							location = {
								region = custom_arabia
							}
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = zikri
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}
					}
					if = {
						limit = {
							location = {
								region = custom_khwarizm
							}
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = manichean
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}
					}
					if = {
						limit = {
							location = {
								region = custom_egypt
							}
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = egyptian_pagan
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}
					}
					if = {
						limit = {
							location = {
								region = custom_abyssinia
							}
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = monophysite
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}
					}	
					if = {
						limit = {
							location = {
								region = custom_nubia
							}
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = miaphysite
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}
					}
					if = {
						limit = {
							location = { region = custom_morocco }
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = bektashi
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}
					}
					if = {
						limit = {
							duchy = {
								OR = {
									title = d_harer
									title = d_berbera
								}
							}
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = nestorian
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}
					}
					if = {
						limit = {
							location = {
								OR = {
									region = world_africa_west
								}
							}
						}
						create_character = {
							random_traits = yes
							age = 16
							religion = west_african_pagan
							culture = THIS
						}
						new_character = {
							usurp_title_plus_barony_if_unlanded = PREV
							set_defacto_liege = THIS
						}
					}					
				}				
				any_claim = {
					PREV = { remove_claim = PREV }
				}
				any_courtier = {
					any_claim = {
						PREV = { remove_claim = PREV }
					}
				}
			}
			any_demesne_title = {
				limit = {
					higher_tier_than = count
				}
				destroy_landed_title = THIS
			}
			any_demesne_title = {
				limit = {
					tier = count
					location = { is_capital = no }
				}				
				create_character = {
					random_traits = yes
					religion = THIS
					culture = THIS
					age = 16
				}
				new_character = {
					usurp_title_plus_barony_if_unlanded = PREV
					set_defacto_liege = THIS
				}
			}
			# This block removes all claims from landholders
			any_claim = {
				remove_claim = PREV
			}
			# This block removes all claims from courtiers
			any_courtier = {
				any_claim = {
					remove_claim = PREV
				}
			}
		}
		any_independent_ruler = { # add Bloodlust to AI characters
			limit = {
				ai = yes
				higher_tier_than = baron
			}
			add_trait = bloodlust
		}
		any_independent_ruler = { # add Yehudi to Jews
			limit = {
				religion_group = jewish_group
			}
			add_trait = yehudi
			set_character_flag = yehudi_check
		}		
		k_papal_state = { # Clear papal vassals, as the first check won't check the papacy
			holder_scope = {
				any_vassal = {
					limit = { tier = count }
					set_defacto_liege = THIS
				}
			}
		}
		# Set Provinces to the correct religions
		any_independent_ruler = {
			any_realm_province = {
				if = {	
					limit = { # Set these regions to be Celtic
						OR = {
							region = custom_france 
							region = custom_aquitaine 
							region = custom_aragon 
							region = custom_navarra 
							region = custom_castille 
							region = custom_asturias 
							region = custom_andalusia
							region = custom_ireland
							region = custom_brittany
							region = custom_scotland
							region = custom_portugal
							region = custom_wales
						}						
					}
					county = {
						holder_scope = {
							religion = celtic_pagan
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = celtic_pagan
						}
					}
				}
				if = {
					limit = { # Set these regions to be Germanic
						OR = {
							region = custom_germany
							region = custom_frisia
							region = custom_lotharingia
							region = custom_burgundy
						}						
					}
					county = {
						holder_scope = {
							religion = german_pagan
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = german_pagan
						}
					}
				}
				if = {
					limit = { # Set these regions to be Hellenic
						OR = {
							region = custom_croatia 
							region = custom_serbia 
							region = custom_bulgaria 
							region = custom_byzantium 
							region = custom_nikaea
							region = custom_trebizond
							region = custom_armenia
							region = custom_italy
							region = custom_sicily
							region = custom_georgia
							duchy = {
								title = d_carinthia
							}
						}						
					}
					county = {
						holder_scope = {
							religion = hellenic_pagan
							culture = roman
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = hellenic_pagan
							if = {
								limit = {
									OR = {
										region = custom_italy
										region = custom_sicily
									}
								}
								culture = roman
							}
						}
					}
				}
				if = {
					limit = { # Set these regions to be Nordic
						OR = {
							region = custom_england 
							region = custom_norway 
							region = custom_sweden
							region = custom_denmark
							region = custom_north_sea
						}						
					}
					county = {
						holder_scope = {
							religion = norse_pagan
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = norse_pagan
						}
					}
				}
				if = {
					limit = { # Set these regions to be Zoroastrian
						OR = {
							region = custom_persia 
							region = custom_afghanistan 
							region = custom_baluchistan 
						}						
					}
					county = {
						holder_scope = {
							religion = zoroastrian
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = zoroastrian
						}
					}
				}
				if = {
					limit = { # Set this region to be Kemetic
						region = custom_egypt				
					}
					county = {
						holder_scope = {
							religion = egyptian_pagan
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = egyptian_pagan
						}
					}
				}
				if = {
					limit = { # Set these regions to be Finnic
						OR = {
							region = custom_finland
							region = custom_perm
						}						
					}
					county = {
						holder_scope = {
							religion = finnish_pagan
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = finnish_pagan
						}
					}
				}
				if = {
					limit = { # Set these regions to be Tengri
						OR = {
							region = custom_cuman
							region = custom_wallachia
							region = custom_crimea
							region = custom_carpathia
							region = custom_volga	
						}						
					}
					county = {
						holder_scope = {
							religion = tengri_pagan
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = tengri_pagan
						}
					}
				}
				if = {
					limit = { # Set this region to be Sunni
						region = custom_mesopotamia					
					}
					county = {
						holder_scope = {
							religion = sunni
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = sunni
						}
					}
				}
				if = {
					limit = { # Set this region to be Zikri
						region = custom_arabia					
					}
					county = {
						holder_scope = {
							religion = zikri
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = zikri
						}
					}
				}
				if = {
					limit = { # Set this region to be Manichean
						region = custom_khwarizm					
					}
					county = {
						holder_scope = {
							religion = manichean
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = manichean
						}
					}
				}
				if = {
					limit = { # Set this region to be Miaphysite
						region = custom_nubia					
					}
					county = {
						holder_scope = {
							religion = miaphysite
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = miaphysite
						}
					}
				}
				if = {
					limit = { # Set this region to be Monophysite
						region = custom_abyssinia					
					}
					county = {
						holder_scope = {
							religion = monophysite
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = monophysite
						}
					}
				}
				if = {
					limit = { # Set these regions to be Shiite
						OR = {
							region = custom_algiers
							region = custom_africa
						}
					}
					county = {
						holder_scope = {
							religion = shiite
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = shiite
						}
					}
				}
				if = {
					limit = { # Set this region to be Bektashi
						region = custom_morocco					
					}
					county = {
						holder_scope = {
							religion = bektashi
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = bektashi
						}
					}
				}
				if = {
					limit = { # Set this region to be Messalian
						region = custom_azerbaijan					
					}
					county = {
						holder_scope = {
							religion = messalian
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = messalian
						}
					}
				}
				if = {
					limit = { # Set these region to be Zun
						OR = {
							region = custom_baluchistan
							region = custom_afghanistan
						}				
					}
					county = {
						holder_scope = {
							religion = zun_pagan
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = zun_pagan
						}
					}
				}
				if = {
					limit = { # Set this region to be Jewish
						region = custom_jerusalem		
					}
					county = {
						holder_scope = {
							religion = jewish
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = jewish
						}
					}
				}
				if = {
					limit = { # Set this region to be Karaite
						region = custom_syria		
					}
					county = {
						holder_scope = {
							religion = karaite
							any_courtier = {
								religion = PREV
								culture = PREV
							}					
						}
						PREV = {
							religion = karaite
						}
					}
				}				
			}
		}
		# Nestorian has no region to use, default to the duchies that make up the target area
		d_harer = { # Set this duchy to be Nestorian
			any_de_jure_vassal_title = {
				holder_scope = {
					religion = nestorian
					any_courtier = {
						religion = PREV
						culture = PREV
					}
				}			
				location = {
					religion = nestorian
				}
			}
		}
		d_berbera = { # Set this duchy to be Nestorian
			any_de_jure_vassal_title = {
				holder_scope = {
					religion = nestorian
					any_courtier = {
						religion = PREV
						culture = PREV
					}
				}			
				location = {
					religion = nestorian
				}
			}
		}		
	}
}

character_event = { # Make dukes out of capital holders
	id = Plus.1452
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		any_independent_ruler = {
			limit = { # Give the ducal title to the one holding the capital
				primary_title = { is_primary_type_title = no } # Prevent it from targeting Mercenaries, Holy Orders and Religious Leaders
				capital_scope = {
					duchy = {
						capital_scope = {
							province = PREVPREV
						}
					}
				}
			}
			capital_scope = {
				duchy = {
					grant_title = PREVPREV
				}
			}
		}
		any_independent_ruler = {
			limit = {
				OR = {
					AND = {
						is_nomadic = no
						tier = duke
					}
					AND = {
						is_nomadic = yes
						num_of_duke_titles = 1
					}
				}
				primary_title = { is_primary_type_title = no } # Prevent it from targeting Mercenaries, Holy Orders and Religious Leaders				
			}
			capital_scope = { # Centralize all counties to the new dukes
				duchy = {
					any_de_jure_vassal_title = {
						limit = {
							higher_tier_than = BARON
							holder_scope = { # So a player not holding the ducal capital won't game over
								ai = yes
							}
						}
						grant_title = PREVPREVPREV
					}
					any_de_jure_vassal = {
						limit = {
							tier = count
						}
						set_defacto_liege = PREVPREVPREV
					}					
				}
			}
		}
	}
}

character_event = { #Make kings out of capital holder
	id = Plus.1453
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		any_independent_ruler = { # Hand out Kingdom titles to the capital holders
			limit = {
				primary_title = { is_primary_type_title = no } # Prevent it from targeting Mercenaries, Holy Orders and Religious Leaders
				capital_scope = {
					kingdom = {
						capital_scope = {
							province = PREVPREV
						}
					}
				}
			}
			capital_scope = {
				kingdom = {
					grant_title = PREVPREV
				}
			}
		}		
		any_independent_ruler = {
			limit = {
				primary_title = { is_primary_type_title = no } # Prevent it from targeting Mercenaries, Holy Orders and Religious Leaders
				is_nomadic = no
				tier = king
			}
			capital_scope = {
				kingdom = {
					any_de_jure_vassal = {
						limit = {
							higher_tier_than = baron
						}					
						set_defacto_liege = PREVPREVPREV
					}
				}
			}
		}
		any_independent_ruler = { # Nomads who should become "king" of the de Jure area. This dissolves the previously generated Khaganates in favour of one unified one
			limit = {
				primary_title = { is_primary_type_title = no } # Prevent it from targeting Mercenaries, Holy Orders and Religious Leaders
				is_nomadic = yes
				num_of_king_titles = 1
			}
			capital_scope = {
				kingdom = {
					any_de_jure_vassal_title = { # make AI lose their titles
						limit = {
							higher_tier_than = baron
							owner = { ai = yes}
						}					
						grant_title = PREVPREVPREV
					}
					any_de_jure_vassal_title = { # make any players not lose their title
						limit = {
							owner = { ai = no}
						}					
						set_defacto_liege = PREVPREVPREV
					}
				}
			}
		}
		any_independent_ruler = {
			limit = { # Create the Khaganate titles as needed
				primary_title = { is_primary_type_title = no } # Prevent it from targeting Mercenaries, Holy Orders and Religious Leaders
				is_nomadic = yes
				NOT = { tier = emperor }
			}			
			capital_scope = { 
				create_title = {
					tier = EMPEROR
					landless = yes
					culture = PREV
					name = "SHATTERED_REALM_KHAGANATE"
					holder = PREV
					base_title = THIS
					dynasty_title_names = no
				}
			}
			any_realm_province = { # Clean out any unwanted, non-nomad, holdings in the new Khaganates
				any_province_holding = {
					if = {
						limit = {
							NOT = { holding_type = nomad }
						}
						destroy_settlement = THIS
					}
				}
			}			
		}	
	}
}

character_event = { # This event introduces the player to shattered realm and gives them the option to back out
	id = Plus.1454
	desc = EVTDESC_Plus.1454
	picture = GFX_evt_book_carolingian_script
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	hide_from = yes
	
	option = {
		name = EVTOPTA_Plus.1454
		custom_tooltip = { text = SHATTERED_REALM_BEGIN2 }
		hidden_tooltip = {
			character_event = { id = Plus.1455 }
		}
	}
	option = {
		name = EVTOPTB_Plus.1454
		custom_tooltip = { text = SHATTERED_REALM_BACKOUT }
		hidden_tooltip = {
			clr_global_flag = shattered_realm
		}
	}
}

character_event = { #This event gives the player the option between ancient religions, or standard religions
	id = Plus.1455
	desc = EVTDESC_Plus.1455
	picture = GFX_evt_book_carolingian_script
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = { #Standard religions
		name = EVTOPTA_Plus.1455
		custom_tooltip = { text = SHATTERED_REALM_STANDARD_RELIGIONS }
		hidden_tooltip = {
			any_courtier = {
				limit = { is_landed = no }
				character_event = { id = Plus.1450 } # All counts
			}
			character_event = { id = Plus.1456 }			
		}
	}
	option = { #Ancient Religions
		name = EVTOPTB_Plus.1455
		trigger = {
			has_dlc = "The Old Gods"
		}
		custom_tooltip = { text = SHATTERED_REALM_ANCIENT_RELIGIONS }
		hidden_tooltip = {
			any_courtier = {
				limit = { is_landed = no }
				character_event = { id = Plus.1451 } # All old-religion counts
			}
			set_global_flag = ancient_religions #This version gets much more lax inheritance law rules
			character_event = { id = Plus.1456 }			
		}
	}
	option = { #Last chance to change mind
		name = EVTOPTC_Plus.1455
		custom_tooltip = { text = SHATTERED_REALM_BACKOUT2 }
		hidden_tooltip = {
			clr_global_flag = shattered_realm
		}
	}	
}

character_event = { #This event allows the player to choose all counts, all duke or all kings
	id = Plus.1456
	desc = EVTDESC_Plus.1456
	picture = GFX_evt_book_carolingian_script
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = { #All counts
		name = EVTOPTA_Plus.1456
		custom_tooltip = { text = SHATTERED_REALM_COUNTS }
		hidden_tooltip = { character_event = { id = Plus.1457 } }
	}
	option = { #All Dukes
		name = EVTOPTB_Plus.1456
		custom_tooltip = { text = SHATTERED_REALM_DUKES }
		hidden_tooltip = {
			any_courtier = {
				limit = { is_landed = no }
				character_event = { id = Plus.1452 }
			}
			character_event = { id = Plus.1457 }			
		}
	}
	option = { #All Kings
		name = EVTOPTC_Plus.1456
		custom_tooltip = { text = SHATTERED_REALM_KINGS }
		hidden_tooltip = {
			any_courtier = {
				limit = { is_landed = no }
				character_event = { id = Plus.1453 }
			}
			character_event = { id = Plus.1457 }			
		}
	}	
}

character_event = { #This event finalizes the setup, adding any flags that are needed
	id = Plus.1457
	desc = EVTDESC_Plus.1457
	picture = GFX_evt_book_carolingian_script
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		any_courtier = {
			limit = {
				is_landed = no
				NOR = { 
					dynasty = PREV
					dynasty = 0
					is_mother = ROOT
					is_father = ROOT
					is_consort = ROOT
					spouse = { dynasty = ROOT }
				}
			}
			death = {
				death_reason = death_natural
			}					
		}								
		any_playable_ruler = {
			any_courtier = {
				limit = {
					is_landed = no
					NOR = { 
						dynasty = PREV
						dynasty = 0
						is_mother = ROOT
						is_father = ROOT
						is_consort = ROOT
						spouse = { dynasty = ROOT }
					}
				}
				death = {
					death_reason = death_natural
				}					
			}
		}
	}	
	
	option = {
		name = EVTOPTA_Plus.1457
		hidden_tooltip = {
			set_global_flag = shattered_realm
			remove_character_modifier = shattered_realm_mod	
			add_character_modifier = { name = shattered_realm_cb_timer duration = 21900 inherit = yes }
			if = {
				limit = {
					wealth = 300
				}
				wealth = -300
			}
			if = {
				limit = {
					wealth = 200
					NOT = { wealth = 300 }
				}
				wealth = -200
			}
			if = {
				limit = {
					wealth = 100
					NOT = { wealth = 200 }
				}
				wealth = -100
			}				
			wealth = 500			
			any_playable_ruler = {
				limit = { ai = no }
				remove_character_modifier = shattered_realm_mod
				add_character_modifier = { name = shattered_realm_cb_timer duration = 21900 inherit = yes }		
			}
			any_playable_ruler = {
				# Start every ruler with a starting budget. For all counts it is 500, all dukes it is 750 and all kings 1500.
				limit = { independent = yes }
				# Clear out any unwanted cash above 100 due to setup.
				if = {
					limit = {
						wealth = 300
					}
					wealth = -300
				}
				if = {
					limit = {
						wealth = 200
						NOT = { wealth = 300 }
					}
					wealth = -200
				}
				if = {
					limit = {
						wealth = 100
						NOT = { wealth = 200 }
					}
					wealth = -100
				}					
				wealth = 500
				if = {
					limit = {
						tier = duke
					}
					wealth = 250
				}					
				if = {
					limit = {
						tier = KING
					}
					wealth = 1000
				}					
			}			
		}
	}	
}

