##############################
# SPYMASTER
#
# Job: action_uncover_plots
#	929: The Spymaster discovers a chance to undermine a faction member
#
# Job: action_study_technology
# 	932: The Spymaster studies foreign technology
# 	933: The Spymaster is discovered by the local count - chance of imprisonment
#
# Job: action_organize_spies
# 	935: Find homosexual
# 	936: Corruption
#
##############################

##############################
# SPYMASTER
# JOB: action_uncover_plots
##############################
# 929: Spymaster undermines faction member
character_event = {
	id = 929
	title = EVTNAME929
	picture = GFX_evt_council
	border = GFX_event_normal_frame_intrigue
	
	desc = {
		text = EVTDESC929_COURT
		trigger = {
			event_target:faction_member = { OR = { leads_faction = faction_court in_faction = faction_court } }
		}
	}
	desc = {
		text = EVTDESC929_PROSPERITY
		trigger = {
			event_target:faction_member = { OR = { leads_faction = faction_prosperity in_faction = faction_prosperity } }
		}
	}
	desc = {
		text = EVTDESC929_GLORY
		trigger = {
			event_target:faction_member = { OR = { leads_faction = faction_glory in_faction = faction_glory } }
		}
	}
	desc = {
		text = EVTDESC929_TRADITION
		trigger = {
			event_target:faction_member = { OR = { leads_faction = faction_tradition in_faction = faction_tradition } }
		}
	}

	capable_only = yes
	prisoner = no
	
	immediate = {
		location = {
			owner = {
				save_event_target_as = faction_member
			}
		}
	}
	
	trigger = {
		has_job_action = action_uncover_plots
		location = {
			owner = {
				same_liege = ROOT
				independent = no
				primary_title = { higher_tier_than = BARON }
				OR = {
					NOT = { has_character_flag = faction_undermine }
					had_character_flag = { flag = faction_undermine days = 1825 }
				}
				NOR = {
					is_liege_of = ROOT
					character = ROOT
					has_opinion_modifier = { who = liege modifier = opinion_coerced_into_leaving_faction }
				}
				OR = {
					AND = {
						OR = {
							leads_faction = faction_court
							in_faction = faction_court
						}
						liege = {
							any_vassal = {
								NOT = { character = PREVPREV }
								higher_tier_than = BARON
								OR = {
									leads_faction = faction_court
									in_faction = faction_court
								}
							}
						}
					}
					AND = {
						OR = {
							leads_faction = faction_prosperity
							in_faction = faction_prosperity
						}
						liege = {
							any_vassal = {
								NOT = { character = PREVPREV }
								higher_tier_than = BARON
								OR = {
									leads_faction = faction_prosperity
									in_faction = faction_prosperity
								}
							}
						}
					}
					AND = {
						OR = {
							leads_faction = faction_glory
							in_faction = faction_glory
						}
						liege = {
							any_vassal = {
								NOT = { character = PREVPREV }
								higher_tier_than = BARON
								OR = {
									leads_faction = faction_glory
									in_faction = faction_glory
								}
							}
						}
					}
					AND = {
						OR = {
							leads_faction = faction_tradition
							in_faction = faction_tradition
						}
						liege = {
							any_vassal = {
								NOT = { character = PREVPREV }
								higher_tier_than = BARON
								OR = {
									leads_faction = faction_tradition
									in_faction = faction_tradition
								}
							}
						}
					}
				}
			}
		}
		liege = {
			NOR = {
				has_character_flag = faction_court_war
				has_character_flag = faction_prosperity_war
				has_character_flag = faction_glory_war
				has_character_flag = faction_tradition_war
				has_character_flag = faction_pretender_war
				has_character_flag = faction_separatist_war
				has_character_flag = faction_religious_war
			}
		}
	}
	
	mean_time_to_happen = {
		months = 100	
		modifier = {
			factor = 1.2
			NOT = { intrigue = 2 }
		}
		modifier = {
			factor = 1.2
			NOT = { intrigue = 3 }
		}
		modifier = {
			factor = 1.2
			NOT = { intrigue = 4 }
		}
		modifier = {
			factor = 1.2
			NOT = { intrigue = 5 }
		}
		modifier = {
			factor = 1.2
			NOT = { intrigue = 6 }
		}
		modifier = {
			factor = 1.2
			NOT = { intrigue = 7 }
		}
		modifier = {
			factor = 1.2
			NOT = { intrigue = 8 }
		}
		modifier = {
			factor = 0.8
			intrigue = 10
		}
		modifier = {
			factor = 0.8
			intrigue = 12
		}
		modifier = {
			factor = 0.8
			intrigue = 14
		}
		modifier = {
			factor = 0.8
			intrigue = 16
		}
		modifier = {
			factor = 0.8
			intrigue = 18
		}
		modifier = {
			factor = 0.8
			intrigue = 20
		}
	}

	option = {
		name = EVTOPTA929 #Report it to the liege
		hidden_tooltip = {
			event_target:faction_member = { set_character_flag = faction_undermine }
		}
		liege = { letter_event = { id = PlusFaction.135 tooltip = INFORM_LIEGE_UNDERMINE } }
	}
	option = {
		name = EVTOPTB929 #Ignore it
		trigger = { ai = no }
		if = {
			limit = {
				NOT = { trait = diligent }
				NOT = { trait = slothful }
			}
			random = {
				chance = 50
				add_trait = slothful
			}
		}
		if = {
			limit = { trait = diligent }
			random = {
				chance = 50
				remove_trait = diligent
			}
		}
	}
}	
	
##############################
# SPYMASTER
# JOB: action_study_technology
##############################

# 932: The Spymaster studies foreign technology
character_event = {
	id = 932
	title = "EVTNAME932"
	desc = "EVTDESC932"
	picture = GFX_evt_library
	border = GFX_event_normal_frame_intrigue

	capable_only = yes
	prisoner = no

	trigger = {
		has_job_action = action_study_technology
		location = { has_higher_tech_than = ROOT }
	}

	mean_time_to_happen = {
		months = 240
		modifier = {
			factor = 0.5
			OR = {
				has_focus = focus_scholarship
				liege = { has_focus = focus_scholarship }
			}
		}
		modifier = {
			factor = 1.1
			NOT = { opinion = { who = liege value = -100 } }
		}
		modifier = {
			factor = 1.1
			NOT = { opinion = { who = liege value = -75 } }
		}
		modifier = {
			factor = 1.1
			NOT = { opinion = { who = liege value = -50 } }
		}
		modifier = {
			factor = 1.1
			NOT = { opinion = { who = liege value = -25 } }
		}
		modifier = {
			factor = 0.95
			opinion = { who = liege value = 25 }
		}
		modifier = {
			factor = 0.95
			opinion = { who = liege value = 50 }
		}
		modifier = {
			factor = 0.95
			opinion = { who = liege value = 75 }
		}
		modifier = {
			factor = 0.95
			opinion = { who = liege value = 100 }
		}
		modifier = {
			factor = 1.05
			NOT = { intrigue = 1 }
		}
		modifier = {
			factor = 1.05
			NOT = { intrigue = 2 }
		}
		modifier = {
			factor = 1.05
			NOT = { intrigue = 3 }
		}
		modifier = {
			factor = 1.05
			NOT = { intrigue = 4 }
		}
		modifier = {
			factor = 1.05
			NOT = { intrigue = 5 }
		}
		modifier = {
			factor = 1.05
			NOT = { intrigue = 6 }
		}
		modifier = {
			factor = 1.05
			NOT = { intrigue = 7 }
		}
		modifier = {
			factor = 1.05
			NOT = { intrigue = 8 }
		}
		modifier = {
			factor = 1.05
			NOT = { intrigue = 9 }
		}
		modifier = {
			factor = 0.95
			intrigue = 10
		}
		modifier = {
			factor = 0.95
			intrigue = 11
		}
		modifier = {
			factor = 0.95
			intrigue = 12
		}
		modifier = {
			factor = 0.95
			intrigue = 13
		}
		modifier = {
			factor = 0.95
			intrigue = 14
		}
		modifier = {
			factor = 0.95
			intrigue = 15
		}
		modifier = {
			factor = 0.95
			intrigue = 16
		}
		modifier = {
			factor = 0.95
			intrigue = 17
		}
		modifier = {
			factor = 0.95
			intrigue = 18
		}
	}

	option = {
		name = "EVTOPTA932"
		liege = { letter_event = { id = 20320 tooltip = "EVTTOOLTIP20320" } }
	}
}

# The Spymaster informs his liege of the success
letter_event = {
	id = 20320
	desc = "EVTDESC20320"
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20320"
		random_list = {
			33 = { military_techpoints = 50 }
			33 = { economy_techpoints = 50 }
			33 = { culture_techpoints = 50 }
		}
	}
}

# 933: The Spymaster is discovered by the local count - chance of imprisonment
character_event = {
	id = 933
	title = "EVTNAME933"
	desc = "EVTDESC933"
	picture = GFX_evt_spymaster
	border = GFX_event_normal_frame_intrigue

	capable_only = yes
	prisoner = no

	trigger = {
		has_job_action = action_study_technology
		location = { has_higher_tech_than = ROOT }
		location = {
			any_province_lord = {
				NOT = { is_liege_of = ROOT }
				NOT = { character = ROOT }
				OR = {
					intrigue = 10
					job_spymaster = {
						intrigue = 10
					}
				}
			}
		}
	}

	mean_time_to_happen = {
		months = 360

		modifier = {
			factor = 0.75
			NOT = { intrigue = 2 }
		}
		modifier = {
			factor = 0.75
			NOT = { intrigue = 3 }
		}
		modifier = {
			factor = 0.75
			NOT = { intrigue = 4 }
		}
		modifier = {
			factor = 0.75
			NOT = { intrigue = 5 }
		}
		modifier = {
			factor = 1.25
			intrigue = 10
		}
		modifier = {
			factor = 1.25
			intrigue = 11
		}
		modifier = {
			factor = 1.25
			intrigue = 12
		}
		modifier = {
			factor = 1.25
			intrigue = 13
		}
	}

	option = {
		name = "EVTOPTA933"
		location = {
			random_province_lord = {
				limit = {
					NOT = { is_liege_of = ROOT }
					NOT = { character = ROOT }
					job_spymaster = {
						intrigue = 10
					}
				}
				character_event = { id = 20330 days = 2 tooltip = "EVTTOOLTIP20330" }
			}
		}
	}
}

#20330: Local noble reacts
character_event = {
	id = 20330
	desc = "EVTDESC20330"
	picture = GFX_evt_spymaster
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EVOPTA20330"
		ai_chance = { factor = 75 }
		FROM = {
			imprison = ROOT
			liege = {
				letter_event = { id = 20331 days = 7 tooltip = "EVTTOOLTIP20331" }
				opinion = {
					modifier = opinion_furious
					who = ROOT
					years = 2
				}
			}
		}
	}
	option = {
		name = "EVOPTB20330"
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				FROM = { has_character_flag = spymaster_found_spying }
			}
		}
		prestige = 15
		FROM = {
			set_character_flag = spymaster_found_spying
			letter_event = { id = 20332 days = 7 tooltip = "EVTTOOLTIP20332" }
		}
	}
}

#20331: Liege get the news - Chancellor Imprisoned
letter_event = {
	id = 20331
	desc = "EVTDESC20331"
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20331"
		FROM = {
			opinion = {
				modifier = opinion_dishonorable_scum
				who = ROOT
				years = 2
			}
		}
	}
}

#20332: Spymaster get the news: is free to go
letter_event = {
	id = 20332
	desc = "EVTDESC20332"
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20332"
		reverse_opinion = {
			modifier = opinion_grateful
			who = FROM
			years = 5
		}
	}
}


##############################
# SPYMASTER
# JOB: action_organize_spies
##############################

# 935: Vicious Rumors Spread
character_event = {
	id = 935
	title = "EVTNAME935"
	desc = "EVTDESC935"
	picture = GFX_evt_whispers
	border = GFX_event_normal_frame_intrigue

	capable_only = yes
	prisoner = no

	trigger = {
		has_job_action = action_organize_spies
		location = {
			any_province_lord = {
				NOT = { is_liege_of = ROOT }
				NOT = { character = ROOT }
				ROOT = {
					liege = {
						NOT = { opinion = { who = PREVPREV value = 0 } }
					}
				}
				num_of_vassals = 1
			}
		}
	}

	mean_time_to_happen = {
		months = 240

		modifier = {
			factor = 1.25
			NOT = { intrigue = 2 }
		}
		modifier = {
			factor = 1.25
			NOT = { intrigue = 3 }
		}
		modifier = {
			factor = 1.25
			NOT = { intrigue = 4 }
		}
		modifier = {
			factor = 1.25
			NOT = { intrigue = 5 }
		}
		modifier = {
			factor = 0.75
			intrigue = 10
		}
		modifier = {
			factor = 0.75
			intrigue = 11
		}
		modifier = {
			factor = 0.75
			intrigue = 12
		}
		modifier = {
			factor = 0.75
			intrigue = 13
		}
	}

	option = {
		name = "EVTOPTA935"
		hidden_tooltip = {
			location = {
				random_province_lord = {
					limit = {
						NOT = { is_liege_of = ROOT }
						NOT = { character = ROOT }
						ROOT = {
							liege = {
								NOT = { opinion = { who = PREVPREV value = 0 } }
							}
						}
						trait = homosexual
						is_female = no
						num_of_vassals = 1
					}
					set_character_flag = vicious_rumor
				}
			}
			liege = { letter_event = { id = 20350 days = 7 } }
		}
	}
}

# 20350 - Liege is informed
letter_event = {
	id = 20350
	desc = "EVTDESC20350"
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20350"
		ai_chance = { factor = 30 }
		hidden_tooltip = {
			FROM = {
				character_event = { id = 20351 days = 7 }
			}
		}
	}
	option = {
		name = "EVTOPTB20350"
		ai_chance = { factor = 70 }
		hidden_tooltip = {
			FROM = {
				character_event = { id = 20352 days = 7 }
			}
		}
	}
	option = {
		name = "EVTOPTC20350"
		ai_chance = { factor = 0 }
		hidden_tooltip = {
			FROM = {
				character_event = { id = 20353 days = 7 }
			}
		}
	}
}

#20351 - Blackmail him
character_event = {
	id = 20351
	desc = "EVTDESC20351"
	picture = GFX_evt_whispers
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20351"
		hidden_tooltip = {
			location = {
				random_province_lord = {
					limit = {
						NOT = { is_liege_of = ROOT }
						NOT = { character = ROOT }
						ROOT = {
							liege = {
								NOT = { opinion = { who = PREVPREV value = 0 } }
							}
						}
						trait = homosexual
						is_female = no
						num_of_vassals = 1
						has_character_flag = vicious_rumor
					}
					set_character_flag = vicious_rumor_blackmail
					character_event = { id = 20354 days = 7 }
				}
			}
		}
	}
}

#20352 - Spread rumors
character_event = {
	id = 20352
	desc = "EVTDESC20352"
	picture = GFX_evt_whispers
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20352"
		hidden_tooltip = {
			location = {
				random_province_lord = {
					limit = {
						NOT = { is_liege_of = ROOT }
						NOT = { character = ROOT }
						ROOT = {
							liege = {
								NOT = { opinion = { who = PREVPREV value = 0 } }
							}
						}
						trait = homosexual
						is_female = no
						num_of_vassals = 1
						has_character_flag = vicious_rumor
					}
					set_character_flag = vicious_rumor_spread
					character_event = { id = 20355 days = 7 }
				}
			}
		}
	}
}

#20353 - Do nothing
character_event = {
	id = 20353
	desc = "EVTDESC20353"
	picture = GFX_evt_throne_room
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20353"
		hidden_tooltip = {
			random_province_lord = {
				limit = {
					NOT = { is_liege_of = ROOT }
					NOT = { character = ROOT }
					ROOT = {
						liege = {
							NOT = { opinion = { who = PREVPREV value = 0 } }
						}
					}
					trait = homosexual
					is_female = no
					num_of_vassals = 1
					has_character_flag = vicious_rumor
				}
				clr_character_flag = vicious_rumor
			}
		}
	}
}

#20354 - The noble responds to blackmail
character_event = {
	id = 20354
	desc = "EVTDESC20354"
	picture = GFX_evt_whispers
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20354"
		ai_chance = { factor = 40 }
		scaled_wealth = -0.25
		hidden_tooltip = {
			FROM = {
				character_event = { id = 20359 days = 1 }
			}
		}
	}
	option = {
		name = "EVTOPTB20354"
		ai_chance = {
			factor = 30
			modifier = {
				factor = 3.0
				OR = {
					trait = wroth
					trait = paranoid
				}
			}
		}
		random_list = {
			50 = {
				FROM = {
					set_character_flag = spymaster_attacked
					character_event = { id = 20356 days = 1 tooltip = "EVTTOOLTIPSPYMASTERATTACK" }
				}
				hidden_tooltip = {
					character_event = { id = 20364 days = 1 }
				}
			}
			50 = {
				FROM = {
					set_character_flag = spymaster_killed
					character_event = { id = 20356 days = 1 tooltip = "EVTTOOLTIPSPYMASTERKILLED" }
				}
				hidden_tooltip = {
					character_event = { id = 20365 days = 1 }
				}
			}
		}
	}
	option = {
		name = "EVTOPTC20354"
		ai_chance = {
			factor = 30
			modifier = {
				factor = 3.0
				OR = {
					trait = proud
					trait = honest
					trait = brave
				}
			}
		}
		prestige = 25
		hidden_tooltip = {
			FROM = {
				character_event = { id = 20361 days = 1 }
			}
		}
	}
}

#20355 - The noble responds to rumor
character_event = {
	id = 20355
	desc = "EVTDESC20355"
	picture = GFX_evt_whispers
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20355"
		piety = -50
		random_list = {
			50 = {
				FROM = {
					set_character_flag = spymaster_attacked
					character_event = { id = 20356 days = 1 tooltip = "EVTTOOLTIPSPYMASTERATTACK" }
				}
				hidden_tooltip = {
					character_event = { id = 20364 days = 1 }
				}
			}
			50 = {
				FROM = {
					set_character_flag = spymaster_killed
					character_event = { id = 20356 days = 1 tooltip = "EVTTOOLTIPSPYMASTERKILLED" }
				}
				hidden_tooltip = {
					character_event = { id = 20365 days = 1 }
				}
			}
		}
	}
	option = {
		name = "EVTOPTB20355"
		piety = -50
		prestige = 25
		hidden_tooltip = {
			FROM = {
				character_event = { id = 20361 days = 1 }
			}
		}
	}
}

#20364 - Spymaster gets away
character_event = {
	id = 20364
	desc = "EVTDESC20364"
	picture = GFX_evt_spymaster
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20364"
		prestige = -10
	}
}

#20365 - Spymaster is killed
character_event = {
	id = 20365
	desc = "EVTDESC20365"
	picture = GFX_evt_death
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EXCELLENT"
	}
}

#20356 - Spymaster is attacked
character_event = {
	id = 20356
	desc = "EVTDESC20356"
	picture = GFX_evt_peasants
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20356"
		trigger = { has_character_flag = spymaster_attacked }
		hidden_tooltip = {
			liege = { letter_event = { id = 20357 days = 1 } }
		}
		clr_character_flag = spymaster_attacked
	}
	option = {
		name = "EVTOPTB20356"
		trigger = { has_character_flag = spymaster_killed }
		hidden_tooltip = {
			liege = { character_event = { id = 20358 days = 1 } }
		}
		clr_character_flag = spymaster_killed
		death = {
			death_reason = death_murder_unknown
			killer = FROM
		}
	}
}

#20357 - Inform the Liege about attack
letter_event = {
	id = 20357
	desc = "EVTDESC20357"
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20357"
		hidden_tooltip = {
			FROM = {
				FROM = {
					character_event = { id = 20363 days = 1 }
				}
			}
		}
	}
}

#20358 - Inform the Liege about death
character_event = {
	id = 20358
	desc = "EVTDESC20358"
	picture = GFX_evt_death
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20358"
		prestige = -15
		hidden_tooltip = {
			FROM = {
				FROM = {
					clr_character_flag = vicious_rumor
				}
			}
		}
	}
}

#20359 - Blackmail succeeds
character_event = {
	id = 20359
	desc = "EVTDESC20359"
	picture = GFX_evt_whispers
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20359"
		hidden_tooltip = {
			liege = { letter_event = { id = 20360 days = 1 } }
		}
	}
}

#20360 - Liege is informed that blackmail succeeded
letter_event = {
	id = 20360
	desc = "EVTDESC20360"
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EXCELLENT"
		wealth = 50
		hidden_tooltip = {
			FROM = {
				FROM = {
					clr_character_flag = vicious_rumor
					clr_character_flag = vicious_rumor_blackmail
				}
			}
		}
	}
}

#20361 - The noble does not care about the rumor
character_event = {
	id = 20361
	desc = "EVTDESC20361"
	picture = GFX_evt_whispers
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20361"
		hidden_tooltip = {
			liege = {
				letter_event = { id = 20362 days = 1 }
			}
		}
	}
}

#20362 - Inform the liege that the noble does not care about the rumor
letter_event = {
	id = 20362
	desc = "EVTDESC20362"
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20362"
		hidden_tooltip = {
			FROM = {
				FROM = {
					character_event = { id = 20363 days = 1 }
				}
			}
		}
	}
}

#20363 - The noble is informed that the rumor has been spread
character_event = {
	id = 20363
	desc = "EVTDESC20363"
	picture = GFX_evt_whispers
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	immediate = {
		hidden_tooltip = {
			any_vassal = {
				limit = {
					NOT = { opinion = { who = ROOT value = 0 } }
					NOT = { trait = homosexual }
				}
				set_character_flag = opinion_liege_homosexual
			}
			any_courtier = {
				limit = {
					NOT = { opinion = { who = ROOT value = 0 } }
					NOT = { trait = homosexual }
				}
				set_character_flag = opinion_liege_homosexual
			}
		}
	}

	option = {
		name = "EVTOPTA20363"
		any_vassal = {
			limit = {
				has_character_flag = opinion_liege_homosexual
			}
			opinion = {
				modifier = opinion_homosexual
				who = ROOT
				years = 2
			}
			clr_character_flag = opinion_liege_homosexual
		}
		any_courtier = {
			limit = {
				has_character_flag = opinion_liege_homosexual
			}
			opinion = {
				modifier = opinion_homosexual
				who = ROOT
				years = 2
			}
			clr_character_flag = opinion_liege_homosexual
		}
	}
}

# 936: Corruption Uncovered
character_event = {
	id = 936
	title = "EVTNAME936"
	desc = "EVTDESC936"
	picture = GFX_evt_whispers
	border = GFX_event_normal_frame_intrigue

	capable_only = yes
	prisoner = no

	trigger = {
		has_job_action = action_organize_spies
		location = {
			any_province_lord = {
				NOT = { is_liege_of = ROOT }
				NOT = { character = ROOT }
				ROOT = {
					liege = {
						NOT = { opinion = { who = PREVPREV value = 0 } }
						same_realm = PREVPREV
					}
				}
			}
		}
	}

	mean_time_to_happen = {
		months = 240

		modifier = {
			factor = 1.25
			NOT = { intrigue = 2 }
		}
		modifier = {
			factor = 1.25
			NOT = { intrigue = 3 }
		}
		modifier = {
			factor = 1.25
			NOT = { intrigue = 4 }
		}
		modifier = {
			factor = 1.25
			NOT = { intrigue = 5 }
		}
		modifier = {
			factor = 0.75
			intrigue = 10
		}
		modifier = {
			factor = 0.75
			intrigue = 11
		}
		modifier = {
			factor = 0.75
			intrigue = 12
		}
		modifier = {
			factor = 0.75
			intrigue = 13
		}
	}

	option = {
		name = "EVTOPTA936"
		hidden_tooltip = {
			location = {
				random_province_lord = {
					limit = {
						NOT = { is_liege_of = ROOT }
						NOT = { character = ROOT }
						ROOT = {
							liege = {
								NOT = { opinion = { who = PREVPREV value = 0 } }
								same_realm = PREVPREV
							}
						}
					}
					set_character_flag = corrupt_nobel
				}
			}
			liege = { letter_event = { id = 20370 days = 1 } }
		}
	}
}

#20370 - Liege is informed
letter_event = {
	id = 20370
	desc = "EVTDESC20370"
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20370"
		ai_chance = { factor = 100 }
		hidden_tooltip = {
			FROM = {
				character_event = { id = 20371 days = 1 }
			}
		}
	}
	option = {
		name = "EVTOPTB20370"
		ai_chance = { factor = 0 }
		hidden_tooltip = {
			FROM = {
				character_event = { id = 20372 days = 1 }
			}
		}
	}
}

#20371 - Accuse him
character_event = {
	id = 20371
	desc = "EVTDESC20371"
	picture = GFX_evt_spymaster
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20371"
		hidden_tooltip = {
			location = {
				random_province_lord = {
					limit = {
						NOT = { is_liege_of = ROOT }
						NOT = { character = ROOT }
						ROOT = {
							liege = {
								NOT = { opinion = { who = PREVPREV value = 0 } }
								same_realm = PREVPREV
							}
						}
					}
					set_character_flag = corrupt_nobel_accused
					character_event = { id = 20373 days = 1 }
				}
			}
		}
	}
}

#20372 - Do nothing
character_event = {
	id = 20372
	desc = "EVTDESC20372"
	picture = GFX_evt_spymaster
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20372"
		hidden_tooltip = {
			location = {
				random_province_lord = {
					limit = {
						NOT = { is_liege_of = ROOT }
						NOT = { character = ROOT }
						ROOT = {
							liege = {
								NOT = { opinion = { who = PREVPREV value = 0 } }
								same_realm = PREVPREV
							}
						}
					}
					clr_character_flag = corrupt_nobel
				}
			}
		}
	}
}

#20373 - The noble responds to accusation
character_event = {
	id = 20373
	desc = "EVTDESC20373"
	picture = GFX_evt_spymaster
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20373"
		random_list = {
			50 = {
				FROM = {
					set_character_flag = spymaster_attacked
					character_event = { id = 20376 days = 1 tooltip = "EVTTOOLTIPSPYMASTERATTACK" }
				}
				hidden_tooltip = {
					character_event = { id = 20374 days = 1 }
				}
			}
			50 = {
				FROM = {
					set_character_flag = spymaster_killed
					character_event = { id = 20376 days = 1 tooltip = "EVTTOOLTIPSPYMASTERKILLED" }
				}
				hidden_tooltip = {
					character_event = { id = 20375 days = 1 }
				}
			}
		}
	}
	option = {
		name = "EVTOPTB20373"
		prestige = -25
		scaled_wealth = -0.25
		clr_character_flag = corrupt_nobel
		hidden_tooltip = {
			FROM = {
				letter_event = { id = 20379 days = 1 }
			}
		}
	}
}

#20374 - Spymaster gets away
character_event = {
	id = 20374
	desc = "EVTDESC20374"
	picture = GFX_evt_spymaster
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20364"
		prestige = -10
	}
}

#20375 - Spymaster is killed
character_event = {
	id = 20375
	desc = "EVTDESC20375"
	picture = GFX_evt_death
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EXCELLENT"
	}
}

#20376 - Spymaster is attacked
character_event = {
	id = 20376
	desc = "EVTDESC20376"
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20376"
		trigger = { has_character_flag = spymaster_attacked }
		hidden_tooltip = {
			liege = { letter_event = { id = 20377 days = 1 } }
		}
		clr_character_flag = spymaster_attacked
	}
	option = {
		name = "EVTOPTB20376"
		trigger = { has_character_flag = spymaster_killed }
		hidden_tooltip = {
			liege = { character_event = { id = 20378 days = 1 } }
		}
		clr_character_flag = spymaster_killed
		death = {
			death_reason = death_murder
			killer = FROM
		}
	}
}

#20377 - Inform the Liege about attack
letter_event = {
	id = 20377
	desc = "EVTDESC20377"
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20377"
		hidden_tooltip = {
			FROM = {
				FROM = {
					character_event = { id = 20363 days = 1 }
				}
			}
		}
	}
}

#20378 - Inform the Liege about death
character_event = {
	id = 20378
	desc = "EVTDESC20378"
	picture = GFX_evt_death
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20378"
		prestige = -15
		hidden_tooltip = {
			FROM = {
				FROM = {
					clr_character_flag = corrupt_nobel
				}
			}
		}
	}
}

#20379 - Noble confess to spymaster
letter_event = {
	id = 20379
	desc = "EVTDESC20379"
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EVTOPTA20379"
		hidden_tooltip = {
			liege = { letter_event = { id = 20369 days = 1 } }
		}
	}
}

#20369 - Spymaster report to liege about confession
letter_event = {
	id = 20369
	desc = "EVTDESC20369"
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	option = {
		name = "EXCELLENT"
		wealth = 50
	}
}


