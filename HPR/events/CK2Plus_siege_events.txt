namespace = Plus

#reserved: Plus.1000 to Plus.1099

#######################################
# WAYLIT SIEGE EVENTS
#
# Original events by waylit
# Re-written by Rylock
#######################################

# On start of siege, send an event to the defender
character_event = {
	id = Plus.1000 #formerly 1100099991
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		siege = { is_attacker = yes }
		location = {
			any_province_lord = {
				siege = { is_attacker = no }
				OR = {
					capital_scope = { province_id = PREVPREV }
					AND = {
						primary_title = { tier = BARON }
						NOT = { num_of_baron_titles = 2 }
					}
				}
				OR = {
					any_courtier = {
						is_close_relative = PREV
						at_location = ROOT
						in_command = no
						NOT = { has_character_modifier = left_at_siege }
						NOT = {	trait = in_hiding }
						NOT = { has_character_modifier = stalwart_defender }
					}
					AND = {
						at_location = ROOT
						NOT = { has_character_modifier = left_at_siege }
						NOT = {	trait = in_hiding }
						NOT = { has_character_modifier = stalwart_defender }
					}
				}
			}
		}
	}
	
	immediate = {
		location = {
			any_province_lord = {
				limit = {
					siege = { is_attacker = no }
					OR = {
						capital_scope = { province_id = PREVPREV }
						AND = {
							primary_title = { tier = BARON }
							NOT = { num_of_baron_titles = 2 }
						}
					}
					OR = {
						any_courtier = {
							is_close_relative = PREV
							at_location = ROOT
							in_command = no
							NOT = { has_character_modifier = left_at_siege }
							NOT = {	trait = in_hiding }
							NOT = { has_character_modifier = stalwart_defender }
						}
						AND = {
							at_location = ROOT
							NOT = { has_character_modifier = left_at_siege }
							NOT = {	trait = in_hiding }
							NOT = { has_character_modifier = stalwart_defender }
						}
					}
				}
				if = {
					limit = {
						any_courtier = {
							is_close_relative = PREV
							at_location = ROOT
							in_command = no
							NOT = { has_character_modifier = left_at_siege }
							NOT = {	trait = in_hiding }
							NOT = { has_character_modifier = stalwart_defender }
						}
					}
					set_character_flag = family_present_at_siege
				}
				if = {
					limit = {
						at_location = ROOT
						NOT = { has_character_modifier = left_at_siege }
						NOT = {	trait = in_hiding }
						NOT = { has_character_modifier = stalwart_defender }
					}
					set_character_flag = personally_present_at_siege
				}
				character_event = { id = Plus.1001 }
			}
		}
	}
}

# Ruler gets option to hide or remain at the castle & must decide whether family hides
character_event = {
	id = Plus.1001 #formerly 1100099998
	title = "EVTNAME_Plus_1001"
	desc = "EVTDESC_Plus_1001"
	picture = "GFX_evt_escape_siege"
	border = "GFX_event_normal_frame_war"

	is_triggered_only = yes
	
	option = {	
		name = "EVTOPTA_Plus_1001" #We remain and defend the castle
		trigger = {
			OR = {
				AND = {
					scaled_wealth = 0.75
					has_character_flag = personally_present_at_siege
					has_character_flag = family_present_at_siege
				}
				scaled_wealth = 0.5
				intrigue = 12
			}
		}
		ai_chance = { 
			factor = 0.5 
			modifier = {
				factor = 0
				OR = {
					trait = incapable
					is_adult = no
				}
			}
			modifier = {
				factor = 5
				trait = brave
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 2
				trait = patient
			}
			modifier = {
				factor = 2
				trait = slothful
			}
		}
		if = {
			limit = {
				has_character_flag = personally_present_at_siege
				NOT = { has_character_modifier = stalwart_defender }
			}
			add_character_modifier = {
				name = stalwart_defender
				duration = 180
			}
			hidden_tooltip = {
				set_character_flag = defending_the_castle
				remove_character_modifier = left_at_siege
				if = {
					limit = {
						NOR = {
							trait = craven
							trait = brave
						}
					}
					random = {
						chance = 25
						add_trait = brave
						character_event = { id = 38270 }
					}
				}
				if = {
					limit = { trait = craven }
					random = {
						chance = 25
						remove_trait = craven
						character_event = { id = 38296 }
					}
				}
				if = {
					limit = {
						NOR = {
							trait = humble
							trait = proud
						}
					}
					random = {
						chance = 25
						add_trait = proud
						character_event = { id = 38261 }
					}
				}
				if = {
					limit = { trait = humble }
					random = {
						chance = 25
						remove_trait = humble
					}
				}
			}
		}
		any_courtier = {
			limit = { 
				at_location = FROM
				is_close_relative = ROOT
				in_command = no
				NOT = { has_character_modifier = left_at_siege }
				NOT = {	trait = in_hiding }
			}
			custom_tooltip = {
				text = EVTTOOLTIPsiegeremain
				hidden_tooltip = {
					add_character_modifier = {
						name = left_at_siege
						duration = 180
					}
					remove_character_modifier = stalwart_defender
				}
			}
		}
		clr_character_flag = personally_present_at_siege
		clr_character_flag = family_present_at_siege
	}
	option = {
		name = "EVTOPTB_Plus_1001" #Send my family into hiding at once
		trigger = {
			NOT = { intrigue = 12 }
			scaled_wealth = 0.5
			NOT = { has_character_flag = personally_present_at_siege }
			has_character_flag = family_present_at_siege
		}
		ai_chance = { 
			factor = 1
			modifier = {
				factor = 5
				trait = kind
			}
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.25
				trait = cruel
			}
			modifier = {
				factor = 5
				any_courtier = {
					is_close_relative = ROOT
					at_location = FROM
					in_command = no
					NOT = { has_character_modifier = left_at_siege }
					NOT = {	trait = in_hiding }
					reverse_opinion = { who = ROOT value = 75 }
				}
			}
		}
		scaled_wealth = -0.5
		hidden_tooltip = {
			if = {
				limit = {
					NOR = {
						trait = cruel
						trait = kind
					}
				}
				random = {
					chance = 25
					add_trait = kind
					character_event = { id = 38268 }
				}
			}
			if = {
				limit = { trait = cruel }
				random = {
					chance = 25
					remove_trait = cruel
				}
			}
		}	
		any_courtier = {
			limit = { 
				at_location = FROM
				is_close_relative = ROOT
				in_command = no
				NOT = { has_character_modifier = left_at_siege }
				NOT = {	trait = in_hiding }
			}
			custom_tooltip = {
				text = EVTTOOLTIPsiegehide
				hidden_tooltip = {
					add_trait = in_hiding
					set_character_flag = in_hiding_siege
					remove_character_modifier = left_at_siege
					remove_character_modifier = stalwart_defender
				}
			}
		}
		clr_character_flag = personally_present_at_siege
		clr_character_flag = family_present_at_siege
	}
	option = {
		name = "EVTOPTC_Plus_1001" #I will take my family and hide until it is safe
		trigger = {
			NOT = { intrigue = 12 }
			scaled_wealth = 0.75
			has_character_flag = personally_present_at_siege
			has_character_flag = family_present_at_siege
		}
		ai_chance = { 
			factor = 0.25
			modifier = {
				factor = 20
				trait = craven
			}
			modifier = {
				factor = 5
				OR = {
					is_female = yes
					NOT = { martial = 8 }
				}
			}
			modifier = {
				factor = 2
				trait = paranoid
			}
			modifier = {
				factor = 2
				trait = diligent
			}
		}			
		scaled_wealth = -0.75
		hidden_tooltip = {
			remove_character_modifier = stalwart_defender
			remove_character_modifier = left_at_siege
			if = {
				limit = {
					NOR = {
						trait = brave
						trait = craven
					}
				}
				random = {
					chance = 20
					add_trait = craven
					character_event = { id = 38257 }
				}
			}
			if = {
				limit = { trait = brave }
				random = {
					chance = 20
					remove_trait = brave
				}
			}
			if = {
				limit = {
					NOR = {
						trait = diligent
						trait = slothful
					}
				}
				random = {
					chance = 20
					add_trait = diligent
					character_event = { id = 38256 }
				}
			}
			if = {
				limit = { trait = slothful }
				random = {
					chance = 20
					remove_trait = slothful
					character_event = { id = 38298 }
				}
			}
		}
		if = {
			limit = {
				NOT = { trait = in_hiding }
			}
			add_trait = in_hiding
			set_character_flag = in_hiding_siege
		}
		any_courtier = {
			limit = { 
				at_location = FROM
				is_close_relative = ROOT
				in_command = no
				NOT = { has_character_modifier = left_at_siege }
				NOT = {	trait = in_hiding }
			}
			custom_tooltip = {
				text = EVTTOOLTIPsiegehide
				hidden_tooltip = {
					add_trait = in_hiding
					set_character_flag = in_hiding_siege
					remove_character_modifier = left_at_siege
					remove_character_modifier = stalwart_defender
				}
			}
		}
		clr_character_flag = personally_present_at_siege
		clr_character_flag = family_present_at_siege
	}
	option = {
		name = "EVTOPTD_Plus_1001" #Send my family into hiding. I will remain here.
		trigger = {
			NOT = { intrigue = 12 }
			scaled_wealth = 0.5
			has_character_flag = personally_present_at_siege
			has_character_flag = family_present_at_siege
		}
		ai_chance = { 
			factor = 1
			modifier = {
				factor = 0
				OR = {
					trait = incapable
					is_adult = no
				}
			}
			modifier = {
				factor = 2
				trait = brave
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 2
				trait = kind
				NOT = { trait = craven }
			}
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.25
				trait = cruel
			}
			modifier = {
				factor = 2
				any_courtier = {
					is_close_relative = ROOT
					at_location = FROM
					in_command = no
					NOT = { has_character_modifier = left_at_siege }
					NOT = { trait = in_hiding }
					reverse_opinion = { who = ROOT value = 75 }
				}
			}
		}
		scaled_wealth = -0.5
		if = {
			limit = {
				NOT = { has_character_modifier = stalwart_defender }
			}
			add_character_modifier = {
				name = stalwart_defender
				duration = 180
			}
		}
		hidden_tooltip = {
			set_character_flag = defending_the_castle
			remove_character_modifier = left_at_siege
			if = {
				limit = {
					NOR = {
						trait = cruel
						trait = kind
					}
				}
				random = {
					chance = 20
					add_trait = kind
					character_event = { id = 38268 }
				}
			}
			if = {
				limit = { trait = cruel }
				random = {
					chance = 20
					remove_trait = cruel
				}
			}
			if = {
				limit = {
					NOR = {
						trait = craven
						trait = brave
					}
				}
				random = {
					chance = 20
					add_trait = brave
					character_event = { id = 38270 }
				}
			}
			if = {
				limit = { trait = craven }
				random = {
					chance = 20
					remove_trait = craven
					character_event = { id = 38296 }
				}
			}
			if = {
				limit = {
					NOR = {
						trait = humble
						trait = proud
					}
				}
				random = {
					chance = 20
					add_trait = proud
					character_event = { id = 38261 }
				}
			}
			if = {
				limit = { trait = humble }
				random = {
					chance = 20
					remove_trait = humble
				}
			}
		}
		any_courtier = {
			limit = { 
				at_location = FROM
				is_close_relative = ROOT
				in_command = no
				NOT = { has_character_modifier = left_at_siege }
				NOT = {	trait = in_hiding }
			}
			custom_tooltip = {
				text = EVTTOOLTIPsiegehide
				hidden_tooltip = {
					add_trait = in_hiding
					set_character_flag = in_hiding_siege
					remove_character_modifier = left_at_siege
					remove_character_modifier = stalwart_defender
				}
			}
		}
		clr_character_flag = personally_present_at_siege
		clr_character_flag = family_present_at_siege
	}
	option = {
		name = "EVTOPTE_Plus_1001" #I will go into hiding at once. Good luck!
		trigger = {
			NOT = { intrigue = 12 }
			scaled_wealth = 0.5
			has_character_flag = personally_present_at_siege
			NOT = { has_character_flag = family_present_at_siege }
		}
		ai_chance = { 
			factor = 0.25
			modifier = {
				factor = 20
				trait = craven
			}
			modifier = {
				factor = 5
				OR = {
					is_female = yes
					NOT = { martial = 8 }
				}
			}
			modifier = {
				factor = 2
				trait = paranoid
			}
		}			
		scaled_wealth = -0.5
		hidden_tooltip = {
			remove_character_modifier = stalwart_defender
			remove_character_modifier = left_at_siege
			if = {
				limit = {
					NOR = {
						trait = brave
						trait = craven
					}
				}
				random = {
					chance = 20
					add_trait = craven
					character_event = { id = 38257 }
				}
			}
			if = {
				limit = { trait = brave }
				random = {
					chance = 20
					remove_trait = brave
				}
			}
		}
		if = {
			limit = {
				NOT = { trait = in_hiding }
			}
			add_trait = in_hiding
			set_character_flag = in_hiding_siege
		}
		clr_character_flag = personally_present_at_siege
		clr_character_flag = family_present_at_siege
	}
	option = {
		name = "EVTOPTB_Plus_1001" #Send my family into hiding at once
		trigger = {
			intrigue = 12
			NOT = { has_character_flag = personally_present_at_siege }
			has_character_flag = family_present_at_siege
		}
		ai_chance = { 
			factor = 1
			modifier = {
				factor = 5
				trait = kind
			}
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.25
				trait = cruel
			}
			modifier = {
				factor = 5
				any_courtier = {
					is_close_relative = ROOT
					at_location = FROM
					in_command = no
					NOT = { has_character_modifier = left_at_siege }
					NOT = {	trait = in_hiding }
					reverse_opinion = { who = ROOT value = 75 }
				}
			}
		}
		tooltip_info = intrigue
		hidden_tooltip = {
			if = {
				limit = {
					NOR = {
						trait = cruel
						trait = kind
					}
				}
				random = {
					chance = 25
					add_trait = kind
					character_event = { id = 38268 }
				}
			}
			if = {
				limit = { trait = cruel }
				random = {
					chance = 25
					remove_trait = cruel
				}
			}
		}	
		any_courtier = {
			limit = { 
				at_location = FROM
				is_close_relative = ROOT
				in_command = no
				NOT = { has_character_modifier = left_at_siege }
				NOT = {	trait = in_hiding }
			}
			custom_tooltip = {
				text = EVTTOOLTIPsiegehide
				hidden_tooltip = {
					add_trait = in_hiding
					set_character_flag = in_hiding_siege
					remove_character_modifier = left_at_siege
					remove_character_modifier = stalwart_defender
				}
			}
		}
		clr_character_flag = personally_present_at_siege
		clr_character_flag = family_present_at_siege
	}
	option = {
		name = "EVTOPTC_Plus_1001" #I will take my family and hide until it is safe
		trigger = {
			intrigue = 12
			has_character_flag = personally_present_at_siege
			has_character_flag = family_present_at_siege
		}
		ai_chance = { 
			factor = 0.25
			modifier = {
				factor = 20
				trait = craven
			}
			modifier = {
				factor = 5
				OR = {
					is_female = yes
					NOT = { martial = 8 }
				}
			}
			modifier = {
				factor = 2
				trait = paranoid
			}
			modifier = {
				factor = 2
				trait = diligent
			}
		}			
		tooltip_info = intrigue
		hidden_tooltip = {
			remove_character_modifier = stalwart_defender
			remove_character_modifier = left_at_siege
			if = {
				limit = {
					NOR = {
						trait = brave
						trait = craven
					}
				}
				random = {
					chance = 20
					add_trait = craven
					character_event = { id = 38257 }
				}
			}
			if = {
				limit = { trait = brave }
				random = {
					chance = 20
					remove_trait = brave
				}
			}
			if = {
				limit = {
					NOR = {
						trait = diligent
						trait = slothful
					}
				}
				random = {
					chance = 20
					add_trait = diligent
					character_event = { id = 38256 }
				}
			}
			if = {
				limit = { trait = slothful }
				random = {
					chance = 20
					remove_trait = slothful
					character_event = { id = 38298 }
				}
			}
		}
		if = {
			limit = {
				NOT = { trait = in_hiding }
			}
			add_trait = in_hiding
			set_character_flag = in_hiding_siege
		}
		any_courtier = {
			limit = { 
				at_location = FROM
				is_close_relative = ROOT
				in_command = no
				NOT = { has_character_modifier = left_at_siege }
				NOT = {	trait = in_hiding }
			}
			custom_tooltip = {
				text = EVTTOOLTIPsiegehide
				hidden_tooltip = {
					add_trait = in_hiding
					set_character_flag = in_hiding_siege
					remove_character_modifier = left_at_siege
					remove_character_modifier = stalwart_defender
				}
			}
		}
		clr_character_flag = personally_present_at_siege
		clr_character_flag = family_present_at_siege
	}
	option = {
		name = "EVTOPTD_Plus_1001" #Send my family into hiding. I will remain here.
		trigger = {
			intrigue = 12
			has_character_flag = personally_present_at_siege
			has_character_flag = family_present_at_siege
		}
		ai_chance = { 
			factor = 1
			modifier = {
				factor = 0
				OR = {
					trait = incapable
					is_adult = no
				}
			}
			modifier = {
				factor = 2
				trait = brave
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 2
				trait = kind
				NOT = { trait = craven }
			}
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.25
				trait = cruel
			}
			modifier = {
				factor = 2
				any_courtier = {
					is_close_relative = ROOT
					at_location = FROM
					in_command = no
					NOT = { has_character_modifier = left_at_siege }
					NOT = { trait = in_hiding }
					reverse_opinion = { who = ROOT value = 75 }
				}
			}
		}
		tooltip_info = intrigue
		if = {
			limit = {
				NOT = { has_character_modifier = stalwart_defender }
			}
			add_character_modifier = {
				name = stalwart_defender
				duration = 180
			}
		}
		hidden_tooltip = {
			set_character_flag = defending_the_castle
			remove_character_modifier = left_at_siege
			if = {
				limit = {
					NOR = {
						trait = cruel
						trait = kind
					}
				}
				random = {
					chance = 20
					add_trait = kind
					character_event = { id = 38268 }
				}
			}
			if = {
				limit = { trait = cruel }
				random = {
					chance = 20
					remove_trait = cruel
				}
			}
			if = {
				limit = {
					NOR = {
						trait = craven
						trait = brave
					}
				}
				random = {
					chance = 20
					add_trait = brave
					character_event = { id = 38270 }
				}
			}
			if = {
				limit = { trait = craven }
				random = {
					chance = 20
					remove_trait = craven
					character_event = { id = 38296 }
				}
			}
			if = {
				limit = {
					NOR = {
						trait = humble
						trait = proud
					}
				}
				random = {
					chance = 20
					add_trait = proud
					character_event = { id = 38261 }
				}
			}
			if = {
				limit = { trait = humble }
				random = {
					chance = 20
					remove_trait = humble
				}
			}
		}
		any_courtier = {
			limit = { 
				at_location = FROM
				is_close_relative = ROOT
				in_command = no
				NOT = { has_character_modifier = left_at_siege }
				NOT = {	trait = in_hiding }
			}
			custom_tooltip = {
				text = EVTTOOLTIPsiegehide
				hidden_tooltip = {
					add_trait = in_hiding
					set_character_flag = in_hiding_siege
					remove_character_modifier = left_at_siege
					remove_character_modifier = stalwart_defender
				}
			}
		}
		clr_character_flag = personally_present_at_siege
		clr_character_flag = family_present_at_siege
	}
	option = {
		name = "EVTOPTE_Plus_1001" #I will go into hiding at once. Good luck!
		trigger = {
			intrigue = 12
			has_character_flag = personally_present_at_siege
			NOT = { has_character_flag = family_present_at_siege }
		}
		ai_chance = { 
			factor = 0.25
			modifier = {
				factor = 20
				trait = craven
			}
			modifier = {
				factor = 5
				OR = {
					is_female = yes
					NOT = { martial = 8 }
				}
			}
			modifier = {
				factor = 2
				trait = paranoid
			}
		}			
		tooltip_info = intrigue
		hidden_tooltip = {
			remove_character_modifier = stalwart_defender
			remove_character_modifier = left_at_siege
			if = {
				limit = {
					NOR = {
						trait = brave
						trait = craven
					}
				}
				random = {
					chance = 20
					add_trait = craven
					character_event = { id = 38257 }
				}
			}
			if = {
				limit = { trait = brave }
				random = {
					chance = 20
					remove_trait = brave
				}
			}
		}
		if = {
			limit = {
				NOT = { trait = in_hiding }
			}
			add_trait = in_hiding
			set_character_flag = in_hiding_siege
		}
		clr_character_flag = personally_present_at_siege
		clr_character_flag = family_present_at_siege
	}
	option = {	
		name = "EVTOPTF_Plus_1001" #There is nothing to be done. It is in the hands of God.
		trigger = {
			OR = {
				AND = {
					NOT = { intrigue = 12 }
					NOT = { scaled_wealth = 0.75 }
					has_character_flag = personally_present_at_siege
					has_character_flag = family_present_at_siege
				}
				AND = {
					NOT = { scaled_wealth = 0.5 }
					NOT = { intrigue = 12 }
				}
			}
		}
		ai_chance = { 
			factor = 0.5
		}		
		if = {
			limit = {
				has_character_flag = personally_present_at_siege
				NOT = { has_character_modifier = stalwart_defender }
			}
			add_character_modifier = {
				name = stalwart_defender
				duration = 180
			}
		}
		if = {
			limit = { has_character_flag = personally_present_at_siege }
			hidden_tooltip = {
				set_character_flag = defending_the_castle
				remove_character_modifier = left_at_siege
				if = {
					limit = {
						NOR = {
							trait = zealous
							trait = cynical
						}
					}
					random = {
						chance = 10
						add_trait = zealous
						character_event = { id = 38269 }
					}
				}
				if = {
					limit = { trait = cynical }
					random = {
						chance = 10
						remove_trait = cynical
					}
				}
			}
		}
		any_courtier = {
			limit = { 
				at_location = FROM
				is_close_relative = ROOT
				in_command = no
				NOT = { has_character_modifier = left_at_siege }
				NOT = {	trait = in_hiding }
			}
			custom_tooltip = {
				text = EVTTOOLTIPsiegeremain
				hidden_tooltip = {
					add_character_modifier = {
						name = left_at_siege
						duration = 180
					}
					remove_character_modifier = stalwart_defender
				}
			}
		}
		clr_character_flag = personally_present_at_siege
		clr_character_flag = family_present_at_siege
	}
}

# Escape from a siege where you have not hidden						
character_event = {
	id = Plus.1005 #formerly 1100099992
	title = "EVTNAME_Plus_1005"
	desc = "EVTDESC_Plus_1005"
	picture = "GFX_evt_siege"
	border = "GFX_event_normal_frame_war"

	is_triggered_only = yes
	
	trigger = {
		siege = {
			is_attacker = no
			enemy = {
				leader = {
					NOT = { has_landed_title = e_rebels }
					rebel = no
				}
			}
		}
		location = { is_capital = yes }
		is_ruler = yes
		is_patrician = no
		prisoner = no
		is_adult = yes
		health = 4
		NOT = { trait = incapable }
		at_location = FROM
		has_character_modifier = stalwart_defender
		had_character_flag = { flag = defending_the_castle days = 20 random = 20 }
	}

	option = { 
		name = "EVTOPTA_Plus_1005" #Slip out a postern door at midnight.
		ai_chance = { 
			factor = 0.75 
			modifier = {
				factor = 0.5
				trait = craven 
			}
			modifier = {
				factor = 2
				trait = brave 
			}
			modifier = {
				factor = 1.5
				trait = ambitious 
			}
			modifier = {
				factor = 0.75
				trait = slothful 
			}
		}
		
		hidden_tooltip = {
			clr_character_flag = defending_the_castle
			random = { 
				chance = 25
				if = {
					limit = { trait = craven }
					remove_trait = craven
				}
				add_trait = brave 
				character_event = { id = 38270 }
			}
			random = { 
				chance = 10
				if = {
					limit = { trait = slothful }
					remove_trait = slothful
					character_event = { id = 38298 }	
				}
			}
			random = { 
				chance = 10
				if = {
					limit = { trait = content }
					remove_trait = content
					character_event = { id = 38299 }	
				}
			}
		}
		random_list = {
			33 = {
				custom_tooltip = {
					text = EVTTOOLTIPsiegeescaped
				}
					hidden_tooltip = {
						character_event = { id = Plus.1007 }
					}
			}
			66 = {
				ROOT = { 
					custom_tooltip = {
						text = EVTTOOLTIPsiegecapturedenemy 
					}
					set_character_flag = captured 
				}
				hidden_tooltip = {
					ROOT = { character_event = { id = Plus.1006 } }		
					siege = { enemy = { leader = { character_event = { id = Plus.1010 } } } }
				}
			}	
		}
	}
	option = { 
		name = "EVTOPTB_Plus_1005" #Brave the sewers.
		ai_chance = { 
			factor = 0.5 
			modifier = {
				factor = 5
				trait = ambitious 
			}
			modifier = {
				factor = 20
				trait = brave 
			}
			modifier = {
				factor = 20
				trait = humble 
			}
			modifier = {
				factor = 0.5
				trait = craven 
			}
			modifier = {
				factor = 0.75
				trait = slothful 
			}
		}		
		hidden_tooltip = {
			clr_character_flag = defending_the_castle
			random = { 
				chance = 25
				if = { 
					limit = { trait = craven }
					remove_trait = craven
				}
				add_trait = brave
				character_event = { id = 38270 }
			}
			random = { 
				chance = 25
				if = { 
					limit = { trait = proud }
					remove_trait = proud
				}
				add_trait = humble
				character_event = { id = 38260 }				
			}
			random = { 
				chance = 10
				remove_trait = slothful
				character_event = { id = 38298 }
			}
			random = { 
				chance = 10
				remove_trait = content
				character_event = { id = 38299 }
			}
			random = { 
				chance = 10
				add_trait = ill
				character_event = { id = 38290 }
			}
			random = { 
				chance = 5
				add_trait = wounded
				character_event = { id = 38280 }
			}
			random = { 
				chance = 5
				add_trait = pneumonic
				character_event = { id = 38290 }
			}
			random = { 
				chance = 5
				add_trait = infirm
				character_event = { id = 38284 }
			}
			random = { 
				chance = 1
				add_trait = maimed
				character_event = { id = 38281 }
			}
		}
		custom_tooltip = { text = "dis_chance" }
		hidden_tooltip = {
			random = { 
				chance = 1
				add_trait = has_tuberculosis
			}
			random = { 
				chance = 1
				add_trait = has_bubonic_plague
			}
			random = { 
				chance = 1
				add_trait = has_typhoid_fever
			}
			random = { 
				chance = 1
				add_trait = has_typhus
			}
			random = { 
				chance = 1
				add_trait = has_small_pox
			}
			random = { 
				chance = 1
				add_trait = has_measles
			}
			random = { 
				chance = 1
				add_trait = leper
			}
		}
		random_list = {
			75 = {
				custom_tooltip = {
					text = EVTTOOLTIPsiegeescaped
				}
				hidden_tooltip = {
					character_event = { id = Plus.1008 }
				}
			}
			25 = {
				ROOT = { 
					custom_tooltip = { 
						text = EVTTOOLTIPsiegecapturedenemy 
					}
					set_character_flag = captured 
				}
				hidden_tooltip = {
					ROOT = { character_event = { id = Plus.1006 } }
					siege = { enemy = { leader = { character_event = { id = Plus.1010 } } } } 
				}
		 
			}
		}
	}
	option = { 
		name = "EVTOPTC_Plus_1005" #Just give me a rope...
		trigger = {
			NOR = {
				trait = weak
				is_ill = yes
			}
		}
		ai_chance = { 
			factor = 0.1 
			modifier = {
				factor = 5
				trait = ambitious 
			}
			modifier = {
				factor = 20
				trait = lunatic 
			}
			modifier = {
				factor = 20
				trait = possessed 
			}
			modifier = {
				factor = 10
				trait = brave 
			}
			modifier = {
				factor = 0.5
				trait = craven 
			}
			modifier = {
				factor = 0.5
				trait = slothful 
			}
			modifier = {
				factor = 0.1
				trait = clubfooted
			}
		}
		clr_character_flag = defending_the_castle
		hidden_tooltip = {
			random = { 
				chance = 50
				if = {
					limit = { trait = craven }
					remove_trait = craven
				}
				add_trait = brave 
				character_event = { id = 38270 }
			}
			random = {
				chance = 50
				if = {
					limit = { trait = humble }
					remove_trait = humble
				}
				add_trait = proud 
				character_event = { id = 38261 }
			}
			random = { 
				chance = 20
				add_trait = lunatic
				character_event = { id = 38304 }
			}
			random = { 
				chance = 20
					if = {
						limit = { trait = paranoid }
						remove_trait = paranoid
					}
					add_trait = trusting
					character_event = { id = 38250 }
			}
			random = { 
				chance = 20
				if = {
					limit = { trait = slothful }
					remove_trait = slothful
					character_event = { id = 38298 }
				}
				if = {
					limit = { trait = content }
					remove_trait = content
					character_event = { id = 38299 }
				}
			}
			random = { 
				chance = 5
				add_trait = wounded
				character_event = { id = 38280 }
			}
			random = { 
				chance = 10
				add_trait = maimed
				character_event = { id = 38281 }
			}
		}
		random_list = {
			70 = {
				custom_tooltip = { 
					text = EVTTOOLTIPsiegeescaped
				}
				hidden_tooltip = {
					character_event = { id = Plus.1009 }
				}
			}
			20 = {
				ROOT = { 
					custom_tooltip = { 
						text = EVTTOOLTIPsiegecapturedenemy
					}
					set_character_flag = captured 
				}		
				hidden_tooltip = {
					ROOT = { character_event = { id = Plus.1006 } }
					siege = { enemy = { leader = { character_event = { id = Plus.1010 } } } }
				}
			}
			10 = {
				ROOT = { death = { death_reason = death_battle_no_killer } }
			}
		}
	}
	option = {
		name = "EVTOPTD_Plus_1005" #I think it's better we wait.
		ai_chance = {
			factor = 5 
			modifier = {
				factor = 2
				trait = content 
			}
			modifier = {
				factor = 2
				trait = patient 
			}
			modifier = {
				factor = 2
				trait = craven 
			}
			modifier = {
				factor = 0.5
				trait = ambitious 
			}
			modifier = {
				factor = 0.1
				trait = brave
			}
			modifier = {
				factor = 2
				trait = slothful 
			}
		}
		hidden_tooltip = {
			clr_character_flag = defending_the_castle
			random = { 
				chance = 25
				if = {
					limit = { trait = wroth }
					remove_trait = wroth
				}
				add_trait = patient
				character_event = { id = 38264 }
			}
			random = { 
				chance = 25
				add_trait = stressed
				character_event = { id = 38282 }
			}
			random = { 
				chance = 5
				if = {
					limit = { trait = brave }
					remove_trait = brave
				}
				add_trait = craven
				character_event = { id = 38257 }
			}
			random = { 
				chance = 5
				if = {
					limit = { trait = greedy }
					remove_trait = greedy
				}
				add_trait = temperate
				character_event = { id = 38276 }
			}
			random = { 
				chance = 5
				if = {
					limit = { trait = trusting }
					remove_trait = trusting
				}
				add_trait = paranoid
				character_event = { id = 38275 }
			}
		}
	}
}
		
# Captured by the enemy while trying to flee the castle
character_event = {
	id = Plus.1006 #formerly 1100099993
	title = "EVTNAME_Plus_1005"
	desc = "EVTDESC_Plus_1006"
	picture = "GFX_evt_into_the_dungeon"
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = "CURSES"
		remove_character_modifier = stalwart_defender
		ROOT = {
			custom_tooltip = { 
				text = EVTTOOLWAYfamilyhatesyou
			}
		}		
	}
}

# Successful escape by postern door
character_event = {
	id = Plus.1007 #formerly 1100099994
	title = "EVTNAME_Plus_1005"
	desc = "EVTDESC_Plus_1007"
	picture = "GFX_evt_escape_siege"
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	trigger = { is_alive = yes }

	option = {
		name = "EVTTOOLTIPsiegeescaped"
		add_trait = in_hiding
		set_character_flag = in_hiding_siege
		hidden_tooltip = {
			remove_character_modifier = left_at_siege
			remove_character_modifier = stalwart_defender
		}		
		add_character_modifier = {
			name = escaped_siege
			duration = 365
		}
		any_courtier = {
			limit = {
				is_close_relative = ROOT
				in_command = no
				at_location = ROOT
				NOT = { trait = in_hiding }
			}
			opinion = {
				modifier = left_behind
				who = ROOT
				months = 12
			}
		}
	}
}

# Successful escape by sewer
character_event = {
	id = Plus.1008 #formerly 1100099995
	title = "EVTNAME_Plus_1005"
	desc = "EVTDESC_Plus_1008"
	picture = "GFX_evt_escape_siege"
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	trigger = { is_alive = yes }

	option = {
		name = "EVTTOOLTIPsiegeescaped"
		add_trait = in_hiding
		set_character_flag = in_hiding_siege
		hidden_tooltip = {
			remove_character_modifier = left_at_siege
			remove_character_modifier = stalwart_defender
		}
		add_character_modifier = {
			name = escaped_siege
			duration = 365
		}
		any_courtier = {
			limit = {
				is_close_relative = ROOT
				in_command = no
				at_location = ROOT
				NOT = { trait = in_hiding }
			}
			opinion = {
				modifier = left_behind
				who = ROOT
				months = 12
			}
		}
	}
}

# Successful escape by wall
character_event = {
	id = Plus.1009 #formerly 1100099996
	title = "EVTNAME_Plus_1005"
	desc = "EVTDESC_Plus_1009"
	picture = "GFX_evt_escape_siege"
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	trigger = { is_alive = yes }

	option = {
		name = "EVTTOOLTIPsiegeescaped"
		add_trait = in_hiding
		set_character_flag = in_hiding_siege
		hidden_tooltip = {
			remove_character_modifier = left_at_siege
			remove_character_modifier = stalwart_defender
		}
		add_character_modifier = {
			name = escaped_siege
			duration = 365
		}
		any_courtier = {
			limit = {
				is_close_relative = ROOT
				in_command = no
				at_location = ROOT
				NOT = { trait = in_hiding }
			}
			opinion = {
				modifier = left_behind
				who = ROOT
				months = 12
			}
		}
	}
}
	
# Notify siege leader that ruler was captured
character_event = {
	id = Plus.1010 #formerly 1100099997
	title = "EVTNAME_Plus_1005"
	desc = "EVTDESC_Plus_1010"
	picture = "GFX_evt_into_the_dungeon"
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTA_Plus_1010"
		siege = {
			enemy = {
				leader = {
					if = {
						limit = { 
							has_character_flag = captured 
							NOT = { trait = in_hiding }
						}
						imprison = ROOT 
						clr_character_flag = captured
						hidden_tooltip = {
							remove_character_modifier = left_at_siege
							remove_character_modifier = stalwart_defender
							any_courtier = {
								limit = {
									is_close_relative = ROOT
									in_command = no
									at_location = ROOT
									NOT = { trait = in_hiding }
								}
								opinion = {
									modifier = left_behind
									who = ROOT
									months = 12
								}
							}
						}
					}
				}
			}
		}	
	}
}

### SIEGE SUCCESS EVENTS -- IMPRISONMENT

# Unit leader at the siege gets the main imprisonment event (if not unreformed pagan)
character_event = {
	id = Plus.1020
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		rebel = no
		NOR = {
			has_landed_title = e_rebels
			has_landed_title = e_mexikha
			any_liege = { has_landed_title = e_mexikha }
		}
		OR = {
			NOT = { religion_group = pagan_group }
			is_reformed_religion = yes
			FROM = { holder_scope = { religion = ROOT } }
		}
		FROM = {
			holder_scope = {
				war_with = ROOT
				NOT = { character = ROOT }
				capital_scope = {
					ROOT = {
						location = {
							province_id = PREVPREV
						}
					}
				}
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				is_ruler = no
				liege = {
					FROM = {
						holder_scope = { war_with = PREVPREV }
					}
				}
			}
			FROM = {
				holder_scope = {
					if = {
						limit = {
							at_location = ROOT
							NOT = { trait = in_hiding }
						}
						ROOT = {
							liege = {
								character_event = { id = Plus.1021 } # present and not hiding
							}
						}
					}
					if = {
						limit = {
							at_location = ROOT
							trait = in_hiding
						}
						ROOT = {
							liege = {
								character_event = { id = Plus.1022 } # present and hiding
							}
						}
					}
					if = {
						limit = {
							NOT = { at_location = ROOT }
							any_courtier = {
								at_location = ROOT
								prisoner = no
								NOT = { character = PREV }
								OR = {
									is_ruler = yes
									is_close_relative = PREV
									father = { is_ruler = yes }
									mother = { is_ruler = yes }
								}
							}
						}
						ROOT = {
							liege = {
								character_event = { id = Plus.1023 } # not present but family present
							}
						}
					}
					if = {
						limit = {
							any_courtier = {
								prisoner = yes
								at_location = ROOT
							}
						}
						ROOT = {
							liege = {
								character_event = { id = Plus.1024 } # prisoners present
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				is_ruler = yes
			}
			FROM = {
				holder_scope = {
					if = {
						limit = {
							at_location = ROOT
							NOT = { trait = in_hiding }
						}
						ROOT = {
							character_event = { id = Plus.1021 } # present and not hiding
						}
					}
					if = {
						limit = {
							at_location = ROOT
							trait = in_hiding
						}
						ROOT = {
							character_event = { id = Plus.1022 } # present and hiding
						}
					}
					if = {
						limit = {
							NOT = { at_location = ROOT }
							any_courtier = {
								at_location = ROOT
								prisoner = no
								NOT = { character = PREV }
								OR = {
									is_ruler = yes
									is_close_relative = PREV
									father = { is_ruler = yes }
									mother = { is_ruler = yes }
								}
							}
						}
						ROOT = {
							character_event = { id = Plus.1023 } # not present but family present
						}
					}
					if = {
						limit = {
							any_courtier = {
								prisoner = yes
								at_location = ROOT
							}
						}
						ROOT = {
							character_event = { id = Plus.1024 } # prisoners present
						}
					}
				}
			}
		}
	}

	}

# The enemy ruler is present and not hiding
character_event = {
	id = Plus.1021
	desc = EVTDESC_Plus_1021
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_war

	hide_from = yes
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTA_Plus_1021" #Take him prisoner at once
		ai_chance = {
			factor = 10
			modifier = {
				factor = 50  
				FROMFROM = { holder_scope = { primary_title = { higher_tier_than = COUNT } } }
			}
			modifier = {
				factor = 100  
				FROMFROM = { holder_scope = { primary_title = { higher_tier_than = DUKE } } }
			}
			modifier = {
				factor = 0.25  
				FROMFROM = { holder_scope = { primary_title = { lower_tier_than = COUNT } } }
			}
			modifier = {
				factor = 2
				trait = cruel
			}
			modifier = {
				factor = 2
				trait = greedy
			}
			modifier = {
				factor = 2
				trait = envious
			}
			modifier = {
				factor = 10
				trait = impaler
			}
			modifier = {
				factor = 10
				trait = wroth
			}
			modifier = {
				factor = 0.25
				trait = charitable
			}
			modifier = {
				factor = 1.5
				trait = just
			}

		}
		hidden_tooltip = {
			if = {
				limit = {
					NOT = { trait = just }
					FROMFROM = {
						holder_scope = {
							any_courtier = {
								at_location = FROMFROM
								prisoner = no
								NOT = { character = PREV }
								OR = {
									is_ruler = yes
									is_close_relative = PREV
									father = { is_ruler = yes }
									mother = { is_ruler = yes }
								}
							}
						}
					}
				}
				random = { 
					chance = 5
					if = {
						limit = {
							NOT = { trait = just }
							NOT = { trait = arbitrary }
						}
						add_trait = just
						character_event = { id = 38267 } # I am Just!
					}
					if = {
						limit = { trait = arbitrary }
						remove_trait = arbitrary
					}				
				}
			}
		}
		FROMFROM = {
			holder_scope = {
				top_liege = {
					any_realm_character = {
						limit = {
							character = PREVPREV
						}
						if = {
							limit = {
								NOT = { intrigue = 6 }
							}
							random_list = {
								20 = { custom_tooltip = { text = "siege_escaped" } }
								20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								60 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
						if = {
							limit = {
								intrigue = 6
								NOT = { intrigue = 12 }
							}
							random_list = {
								30 = { custom_tooltip = { text = "siege_escaped" } }
								30 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								40 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
						if = {
							limit = {
								intrigue = 12
								NOT = { intrigue = 18 }
							}
							random_list = {
								60 = { custom_tooltip = { text = "siege_escaped" } }
								20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								20 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
						if = {
							limit = {
								character = PREVPREV
								intrigue = 18
							}
							random_list = {
								80 = { custom_tooltip = { text = "siege_escaped" } }
								10 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								10 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
					}
				}
			}
		}
	}
	option = {
		name = "EVTOPTB_Plus_1021" #Imprison him and anyone else we find
		trigger = {
			FROMFROM = {
				holder_scope = {
					any_courtier = {
						at_location = FROMFROM
						prisoner = no
						NOT = { character = PREV }
						OR = {
							is_ruler = yes
							is_close_relative = PREV
							father = {
								is_ruler = yes
								is_alive = yes
							}
							mother = {
								is_ruler = yes
								is_alive = yes
							}
						}
					}
				}
			}
		}
		ai_chance = {
			factor = 0.5
			modifier = {
				factor = 0.1
				FROMFROM = { holder_scope = { primary_title = { lower_tier_than = COUNT } } }
			}
			modifier = {
				factor = 40
				FROMFROM = { holder_scope = { 
					any_dynasty_member = { primary_title = { higher_tier_than = COUNT } } } }
			}
			modifier = {
				factor = 100
				FROMFROM = { holder_scope = { 
					any_dynasty_member = { primary_title = { higher_tier_than = DUKE } } } }
			}
			modifier = {
				factor = 8
				trait = cruel
			}
			modifier = {
				factor = 8
				trait = greedy
			}
			modifier = {
				factor = 0
				trait = kind
			}
			modifier = {
				factor = 20
				trait = impaler
			}
			modifier = {
				factor = 20
				trait = wroth
			}	
		}
		hidden_tooltip = {
			if = {
				limit = { NOT = { trait = greedy } }
				random = { 			
					chance = 10
					if = {
						limit = {
							NOT = { trait = greedy }
							NOT = { trait = charitable }
						}
						add_trait = greedy
						character_event = { id = 38252 } # I am greedy!
					}
					if = {
						limit = { trait = charitable }
						remove_trait = charitable
					}
				}
			}
		}
		FROMFROM = {
			holder_scope = {
				top_liege = {
					any_realm_character = {
						limit = {
							character = PREVPREV
						}
						if = {
							limit = {
								NOT = { intrigue = 6 }
							}
							random_list = {
								20 = { custom_tooltip = { text = "siege_escaped" } }
								20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								60 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
						if = {
							limit = {
								intrigue = 6
								NOT = { intrigue = 12 }
							}
							random_list = {
								30 = { custom_tooltip = { text = "siege_escaped" } }
								30 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								40 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
						if = {
							limit = {
								intrigue = 12
								NOT = { intrigue = 18 }
							}
							random_list = {
								60 = { custom_tooltip = { text = "siege_escaped" } }
								20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								20 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
						if = {
							limit = {
								character = PREVPREV
								intrigue = 18
							}
							random_list = {
								80 = { custom_tooltip = { text = "siege_escaped" } }
								10 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								10 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
					}
				}
				any_courtier = {
					limit = {
						at_location = FROMFROM
						prisoner = no
						NOT = { character = PREV }
						OR = {
							is_ruler = yes
							is_close_relative = PREV
							father = {
								is_ruler = yes
								is_alive = yes
							}
							mother = {
								is_ruler = yes
								is_alive = yes
							}
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							NOT = { intrigue = 6 }
						}
						random_list = {
							20 = { custom_tooltip = { text = "siege_escaped" } }
							20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							60 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							30 = { custom_tooltip = { text = "siege_escaped" } }
							30 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							40 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 12
							NOT = { intrigue = 18 }
						}
						random_list = {
							60 = { custom_tooltip = { text = "siege_escaped" } }
							20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							20 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							trait = in_hiding
							NOT = { intrigue = 6 }
						}
						random_list = {
							70 = { custom_tooltip = { text = "siege_escaped" } }
							20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							10 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							trait = in_hiding
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							85 = { custom_tooltip = { text = "siege_escaped" } }
							10 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							5 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
				}
			}
		}
	}
	option = {
		name = "EVTOPTC_Plus_1021" #Kill him and anyone else within
		trigger = {
			NOR = {
				trait = just
				trait = kind
			}
		}
		ai_chance = {
			factor = 0.5
			modifier = {
				factor = 0
				FROMFROM = {
					holder_scope = {
						ROOT = {
							independent = no
							liege = {
								OR = {
									is_close_relative = PREVPREV
									dynasty = PREVPREV
								}
							}
						}
					}
				}
			}
			modifier = {
				factor = 0
				FROMFROM = {
					holder_scope = { is_close_relative = ROOT }
				}
			}
			modifier = {
				factor = 0.1
				FROMFROM = {
					holder_scope = { dynasty = ROOT }
				}
			}
			modifier = {
				factor = 20
				trait = cruel
			}
			modifier = {
				factor = 10
				trait = arbitrary
			}
			modifier = {
				factor = 0.5
				trait = diligent
			}
			modifier = {
				factor = 20
				trait = impaler
			}
			modifier = {
				factor = 20
				trait = wroth
			}
			modifier = {
				factor = 0.3
				trait = charitable
			}
			modifier = {
				factor = 0.3
				trait = humble
			}
			modifier = {
				factor = 0.5
				trait = honest
			}
		}
		if = {
			limit = { NOT  = { lifestyle_traits = 1 } }
			add_trait = impaler
		}
		hidden_tooltip = {
			if = {
				limit = { NOT = { trait = cruel } }
				random = { 			
					chance = 50
					add_trait = cruel
					hidden_tooltip = { character_event = { id = 38259 } } # notify cruel
				}
			}
			if = {
				limit = { NOT = { trait = arbitrary } }
				random = { 			
					chance = 20
					add_trait = arbitrary
					hidden_tooltip = { character_event = { id = 38266 } } # notify arbitrary
				}
			}
		}
		if = {
			limit = {
				trait = dishonorable9
			}
			remove_trait = dishonorable9
			add_trait = dishonorable10
		}
		if = {
			limit = {
				trait = dishonorable8
			}
			remove_trait = dishonorable8
			add_trait = dishonorable9
		}
		if = {
			limit = {
				trait = dishonorable7
			}
			remove_trait = dishonorable7
			add_trait = dishonorable8
		}
		if = {
			limit = {
				trait = dishonorable6
			}
			remove_trait = dishonorable6
			add_trait = dishonorable7
		}
		if = {
			limit = {
				trait = dishonorable5
			}
			remove_trait = dishonorable5
			add_trait = dishonorable6
		}
		if = {
			limit = {
				trait = dishonorable4
			}
			remove_trait = dishonorable4
			add_trait = dishonorable5
		}
		if = {
			limit = {
				trait = dishonorable3
			}
			remove_trait = dishonorable3
			add_trait = dishonorable4
		}
		if = {
			limit = {
				trait = dishonorable2
			}
			remove_trait = dishonorable2
			add_trait = dishonorable3
		}
		if = {
			limit = {
				trait = dishonorable1
			}
			remove_trait = dishonorable1
			add_trait = dishonorable2
		}
		if = {
			limit = {
				trait = dyn_dishonorable9
			}
			remove_trait = dyn_dishonorable9
			add_trait = dishonorable10
		}
		if = {
			limit = {
				trait = dyn_dishonorable8
			}
			remove_trait = dyn_dishonorable8
			add_trait = dishonorable9
		}
		if = {
			limit = {
				trait = dyn_dishonorable7
			}
			remove_trait = dyn_dishonorable7
			add_trait = dishonorable8
		}
		if = {
			limit = {
				trait = dyn_dishonorable6
			}
			remove_trait = dyn_dishonorable6
			add_trait = dishonorable7
		}
		if = {
			limit = {
				trait = dyn_dishonorable5
			}
			remove_trait = dyn_dishonorable5
			add_trait = dishonorable6
		}
		if = {
			limit = {
				trait = dyn_dishonorable4
			}
			remove_trait = dyn_dishonorable4
			add_trait = dishonorable5
		}
		if = {
			limit = {
				trait = dyn_dishonorable3
			}
			remove_trait = dyn_dishonorable3
			add_trait = dishonorable4
		}
		if = {
			limit = {
				trait = dyn_dishonorable2
			}
			remove_trait = dyn_dishonorable2
			add_trait = dishonorable3
		}
		if = {
			limit = {
				trait = dyn_dishonorable1
			}
			remove_trait = dyn_dishonorable1
			add_trait = dishonorable2
		}
		if = {
			limit = {
				NOT = { trait = dishonorable1 }
				NOT = { trait = dishonorable2 }
				NOT = { trait = dishonorable3 }
				NOT = { trait = dishonorable4 }
				NOT = { trait = dishonorable5 }
				NOT = { trait = dishonorable6 }
				NOT = { trait = dishonorable7 }
				NOT = { trait = dishonorable8 }
				NOT = { trait = dishonorable9 }
				NOT = { trait = dishonorable10 }
				NOT = { trait = dyn_dishonorable1 }
				NOT = { trait = dyn_dishonorable2 }
				NOT = { trait = dyn_dishonorable3 }
				NOT = { trait = dyn_dishonorable4 }
				NOT = { trait = dyn_dishonorable5 }
				NOT = { trait = dyn_dishonorable6 }
				NOT = { trait = dyn_dishonorable7 }
				NOT = { trait = dyn_dishonorable8 }
				NOT = { trait = dyn_dishonorable9 }
				NOT = { trait = dyn_dishonorable10 }
			}
			add_trait = dishonorable1
		}
		FROMFROM = {
			holder_scope = {
				top_liege = {
					any_realm_character = {
						limit = {
							character = PREVPREV
						}
						if = {
							limit = {
								NOT = { intrigue = 6 }
							}
							random_list = {
								20 = { custom_tooltip = { text = "siege_escaped" } }
								40 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								40 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
							}
						}
						if = {
							limit = {
								intrigue = 6
								NOT = { intrigue = 12 }
							}
							random_list = {
								30 = { custom_tooltip = { text = "siege_escaped" } }
								50 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								20 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
							}
						}
						if = {
							limit = {
								intrigue = 12
								NOT = { intrigue = 18 }
							}
							random_list = {
								60 = { custom_tooltip = { text = "siege_escaped" } }
								30 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								10 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
							}
						}
						if = {
							limit = {
								intrigue = 18
							}
							random_list = {
								70 = { custom_tooltip = { text = "siege_escaped" } }
								25 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								5 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
					}
				}
				any_courtier = {
					limit = {
						at_location = FROMFROM
						prisoner = no
						NOT = { character = PREV }
						OR = {
							is_ruler = yes
							is_close_relative = PREV
							father = {
								is_ruler = yes
								is_alive = yes
							}
							mother = {
								is_ruler = yes
								is_alive = yes
							}
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							NOT = { intrigue = 6 }
						}
						random_list = {
							20 = { custom_tooltip = { text = "siege_escaped" } }
							40 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							40 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							30 = { custom_tooltip = { text = "siege_escaped" } }
							50 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							20 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 12
							NOT = { intrigue = 18 }
						}
						random_list = {
							60 = { custom_tooltip = { text = "siege_escaped" } }
							30 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							10 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							character = PREVPREV
							intrigue = 18
						}
						random_list = {
							70 = { custom_tooltip = { text = "siege_escaped" } }
							25 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							5 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							trait = in_hiding
							NOT = { intrigue = 6 }
						}
						random_list = {
							50 = { custom_tooltip = { text = "siege_escaped" } }
							40 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							10 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							trait = in_hiding
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							70 = { custom_tooltip = { text = "siege_escaped" } }
							25 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							5 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							trait = in_hiding
							character = PREVPREV
							intrigue = 12
						}
						random_list = {
							85 = { custom_tooltip = { text = "siege_escaped" } }
							13 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							2 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
				}
			}
		}
	}
	option = {
		name = "EVTOPTD_Plus_1021" #Leave him and his family be.
		ai_chance = {
			factor = 1
			modifier = {
				factor = 10
				trait = kind
			}
			modifier = {
				factor = 3
				trait = charitable
			}
			modifier = {
				factor = 3
				trait = humble
			}
			modifier = {
				factor = 0.5
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = greedy
			}
			modifier = {
				factor = 0.5
				trait = cruel
			}	
		}
		hidden_tooltip = {
			if = {
				limit = { NOT = { trait = kind } }
				random = { 			
					chance = 10
					if = {
						limit = {
							NOT = { trait = kind }
							NOT = { trait = cruel }
						}
						add_trait = kind
						hidden_tooltip = { character_event = { id = 38268 } } # notify kind
					}
					if = {
						limit = { trait = cruel }
						remove_trait = cruel
					}
				}
			}
			if = {
				limit = { NOT = { trait = charitable } }
				random = { 			
					chance = 10
					if = {
						limit = {
							NOT = { trait = charitable }
							NOT = { trait = greedy }
						}
						add_trait = charitable
						character_event = { id = 38273 } # I am charitable!
					}
					if = {
						limit = { trait = greedy }
						remove_trait = greedy
					}
				}
			}
		}
		FROMFROM = {
			holder_scope = {
				top_liege = {
					any_realm_character = {
						limit = {
							character = PREVPREV
						}
						opinion = {
							who = ROOT
							modifier = opinion_relieved
							months = 12
						}
					}
				}
				any_courtier = {
					limit = {
						NOT = { trait = in_hiding }
						at_location = FROMFROM
						prisoner = no
						NOT = { character = PREV }
						OR = {
							is_ruler = yes
							is_close_relative = PREV
							father = {
								is_ruler = yes
								is_alive = yes
							}
							mother = {
								is_ruler = yes
								is_alive = yes
							}
						}
					}			
					opinion = {
						who = ROOT
						modifier = opinion_relieved
						months = 12
					}
				}
			}
		}
	}
}

# The enemy ruler is present and hiding
character_event = {
	id = Plus.1022
	desc = EVTDESC_Plus_1022
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_war

	hide_from = yes
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTA_Plus_1022" #Find him -- he's the only one we want
		ai_chance = {
			factor = 10
			modifier = {
				factor = 50  
				FROMFROM = { holder_scope = { primary_title = { higher_tier_than = COUNT } } }
			}
			modifier = {
				factor = 100  
				FROMFROM = { holder_scope = { primary_title = { higher_tier_than = DUKE } } }
			}
			modifier = {
				factor = 0.25  
				FROMFROM = { holder_scope = { primary_title = { lower_tier_than = COUNT } } }
			}
			modifier = {
				factor = 2
				trait = cruel
			}
			modifier = {
				factor = 2
				trait = greedy
			}
			modifier = {
				factor = 2
				trait = envious
			}
			modifier = {
				factor = 10
				trait = impaler
			}
			modifier = {
				factor = 10
				trait = wroth
			}
			modifier = {
				factor = 0.25
				trait = charitable
			}
			modifier = {
				factor = 1.5
				trait = just
			}

		}
		hidden_tooltip = {
			if = {
				limit = {
					NOT = { trait = just }
					FROMFROM = {
						holder_scope = {
							any_courtier = {
								at_location = FROMFROM
								prisoner = no
								NOT = { character = PREV }
								OR = {
									is_ruler = yes
									is_close_relative = PREV
									father = {
										is_ruler = yes
										is_alive = yes
									}
									mother = {
										is_ruler = yes
										is_alive = yes
									}
								}
							}
						}
					}
				}
				random = { 
					chance = 5
					if = {
						limit = {
							NOT = { trait = just }
							NOT = { trait = arbitrary }
						}
						add_trait = just
						character_event = { id = 38267 } # I am Just!
					}
					if = {
						limit = { trait = arbitrary }
						remove_trait = arbitrary
					}				
				}
			}
		}
		FROMFROM = {
			holder_scope = {
				top_liege = {
					any_realm_character = {
						limit = {
							character = PREVPREV
						}
						if = {
							limit = {
								NOT = { intrigue = 6 }
							}
							random_list = {
								70 = { custom_tooltip = { text = "siege_escaped" } }
								20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								10 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
						if = {
							limit = {
								intrigue = 6
								NOT = { intrigue = 12 }
							}
							random_list = {
								85 = { custom_tooltip = { text = "siege_escaped" } }
								10 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								5 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
						if = {
							limit = {
								intrigue = 12
							}
							random_list = {
								93 = { custom_tooltip = { text = "siege_escaped" } }
								5 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								2 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
					}
				}
			}
		}
	}
	option = {
		name = "EVTOPTB_Plus_1022" #Find him and anyone else of importance
		trigger = {
			FROMFROM = {
				holder_scope = {
					any_courtier = {
						at_location = FROMFROM
						prisoner = no
						NOT = { character = PREV }
						OR = {
							is_ruler = yes
							is_close_relative = PREV
							father = {
								is_ruler = yes
								is_alive = yes
							}
							mother = {
								is_ruler = yes
								is_alive = yes
							}
						}
					}
				}
			}
		}
		ai_chance = {
			factor = 0.5
			modifier = {
				factor = 0.1
				FROMFROM = { holder_scope = { primary_title = { lower_tier_than = COUNT } } }
			}
			modifier = {
				factor = 40
				FROMFROM = { holder_scope = { 
					any_dynasty_member = { primary_title = { higher_tier_than = COUNT } } } }
			}
			modifier = {
				factor = 100
				FROMFROM = { holder_scope = { 
					any_dynasty_member = { primary_title = { higher_tier_than = DUKE } } } }
			}
			modifier = {
				factor = 8
				trait = cruel
			}
			modifier = {
				factor = 8
				trait = greedy
			}
			modifier = {
				factor = 0
				trait = kind
			}
			modifier = {
				factor = 20
				trait = impaler
			}
			modifier = {
				factor = 20
				trait = wroth
			}	
		}
		hidden_tooltip = {
			if = {
				limit = { NOT = { trait = greedy } }
				random = { 			
					chance = 10
					if = {
						limit = {
							NOT = { trait = greedy }
							NOT = { trait = charitable }
						}
						add_trait = greedy
						hidden_tooltip = { character_event = { id = 38252 } } # notify greedy
					}
					if = {
						limit = { trait = charitable }
						remove_trait = charitable
					}
				}
			}
		}
		FROMFROM = {
			holder_scope = {
				top_liege = {
					any_realm_character = {
						limit = {
							character = PREVPREV
						}
						if = {
							limit = {
								NOT = { intrigue = 6 }
							}
							random_list = {
								70 = { custom_tooltip = { text = "siege_escaped" } }
								20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								10 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
						if = {
							limit = {
								intrigue = 6
								NOT = { intrigue = 12 }
							}
							random_list = {
								85 = { custom_tooltip = { text = "siege_escaped" } }
								10 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								5 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
						if = {
							limit = {
								intrigue = 12
							}
							random_list = {
								93 = { custom_tooltip = { text = "siege_escaped" } }
								5 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								2 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
					}
				}
				any_courtier = {
					limit = {
						at_location = FROMFROM
						prisoner = no
						NOT = { character = PREV }
						OR = {
							is_ruler = yes
							is_close_relative = PREV
							father = {
								is_ruler = yes
								is_alive = yes
							}
							mother = {
								is_ruler = yes
								is_alive = yes
							}
						}
					}
					if = {
						limit = {
							trait = in_hiding
							NOT = { intrigue = 6 }
						}
						random_list = {
							70 = { custom_tooltip = { text = "siege_escaped" } }
							20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							10 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							trait = in_hiding
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							85 = { custom_tooltip = { text = "siege_escaped" } }
							10 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							5 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							NOT = { intrigue = 6 }
						}
						random_list = {
							20 = { custom_tooltip = { text = "siege_escaped" } }
							20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							60 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							30 = { custom_tooltip = { text = "siege_escaped" } }
							30 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							40 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 12
							NOT = { intrigue = 18 }
						}
						random_list = {
							60 = { custom_tooltip = { text = "siege_escaped" } }
							20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							20 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
				}
			}
		}
	}
	option = {
		name = "EVTOPTC_Plus_1022" #Kill everyone we can find
		trigger = {
			NOR = {
				trait = just
				trait = kind
			}
		}
		ai_chance = {
			factor = 0.5
			modifier = {
				factor = 0
				FROMFROM = {
					holder_scope = {
						ROOT = {
							independent = no
							liege = {
								OR = {
									is_close_relative = PREVPREV
									dynasty = PREVPREV
								}
							}
						}
					}
				}
			}
			modifier = {
				factor = 0
				FROMFROM = {
					holder_scope = { is_close_relative = ROOT }
				}
			}
			modifier = {
				factor = 0.1
				FROMFROM = {
					holder_scope = { dynasty = ROOT }
				}
			}
			modifier = {
				factor = 20
				trait = cruel
			}
			modifier = {
				factor = 10
				trait = arbitrary
			}
			modifier = {
				factor = 0.5
				trait = diligent
			}
			modifier = {
				factor = 20
				trait = impaler
			}
			modifier = {
				factor = 20
				trait = wroth
			}
			modifier = {
				factor = 0.3
				trait = charitable
			}
			modifier = {
				factor = 0.3
				trait = humble
			}
			modifier = {
				factor = 0.5
				trait = honest
			}
		}
		if = {
			limit = { NOT  = { lifestyle_traits = 1 } }
			add_trait = impaler
		}
		hidden_tooltip = {
			if = {
				limit = { NOT = { trait = cruel } }
				random = { 			
					chance = 50
					add_trait = cruel
					hidden_tooltip = { character_event = { id = 38259 } } # I am cruel!
				}
			}
			if = {
				limit = { NOT = { trait = arbitrary } }
				random = { 			
					chance = 20
					add_trait = arbitrary
					hidden_tooltip = { character_event = { id = 38266 } } # I am arbitrary!
				}
			}
		}
		if = {
			limit = {
				trait = dishonorable9
			}
			remove_trait = dishonorable9
			add_trait = dishonorable10
		}
		if = {
			limit = {
				trait = dishonorable8
			}
			remove_trait = dishonorable8
			add_trait = dishonorable9
		}
		if = {
			limit = {
				trait = dishonorable7
			}
			remove_trait = dishonorable7
			add_trait = dishonorable8
		}
		if = {
			limit = {
				trait = dishonorable6
			}
			remove_trait = dishonorable6
			add_trait = dishonorable7
		}
		if = {
			limit = {
				trait = dishonorable5
			}
			remove_trait = dishonorable5
			add_trait = dishonorable6
		}
		if = {
			limit = {
				trait = dishonorable4
			}
			remove_trait = dishonorable4
			add_trait = dishonorable5
		}
		if = {
			limit = {
				trait = dishonorable3
			}
			remove_trait = dishonorable3
			add_trait = dishonorable4
		}
		if = {
			limit = {
				trait = dishonorable2
			}
			remove_trait = dishonorable2
			add_trait = dishonorable3
		}
		if = {
			limit = {
				trait = dishonorable1
			}
			remove_trait = dishonorable1
			add_trait = dishonorable2
		}
		if = {
			limit = {
				trait = dyn_dishonorable9
			}
			remove_trait = dyn_dishonorable9
			add_trait = dishonorable10
		}
		if = {
			limit = {
				trait = dyn_dishonorable8
			}
			remove_trait = dyn_dishonorable8
			add_trait = dishonorable9
		}
		if = {
			limit = {
				trait = dyn_dishonorable7
			}
			remove_trait = dyn_dishonorable7
			add_trait = dishonorable8
		}
		if = {
			limit = {
				trait = dyn_dishonorable6
			}
			remove_trait = dyn_dishonorable6
			add_trait = dishonorable7
		}
		if = {
			limit = {
				trait = dyn_dishonorable5
			}
			remove_trait = dyn_dishonorable5
			add_trait = dishonorable6
		}
		if = {
			limit = {
				trait = dyn_dishonorable4
			}
			remove_trait = dyn_dishonorable4
			add_trait = dishonorable5
		}
		if = {
			limit = {
				trait = dyn_dishonorable3
			}
			remove_trait = dyn_dishonorable3
			add_trait = dishonorable4
		}
		if = {
			limit = {
				trait = dyn_dishonorable2
			}
			remove_trait = dyn_dishonorable2
			add_trait = dishonorable3
		}
		if = {
			limit = {
				trait = dyn_dishonorable1
			}
			remove_trait = dyn_dishonorable1
			add_trait = dishonorable2
		}
		if = {
			limit = {
				NOT = { trait = dishonorable1 }
				NOT = { trait = dishonorable2 }
				NOT = { trait = dishonorable3 }
				NOT = { trait = dishonorable4 }
				NOT = { trait = dishonorable5 }
				NOT = { trait = dishonorable6 }
				NOT = { trait = dishonorable7 }
				NOT = { trait = dishonorable8 }
				NOT = { trait = dishonorable9 }
				NOT = { trait = dishonorable10 }
				NOT = { trait = dyn_dishonorable1 }
				NOT = { trait = dyn_dishonorable2 }
				NOT = { trait = dyn_dishonorable3 }
				NOT = { trait = dyn_dishonorable4 }
				NOT = { trait = dyn_dishonorable5 }
				NOT = { trait = dyn_dishonorable6 }
				NOT = { trait = dyn_dishonorable7 }
				NOT = { trait = dyn_dishonorable8 }
				NOT = { trait = dyn_dishonorable9 }
				NOT = { trait = dyn_dishonorable10 }
			}
			add_trait = dishonorable1
		}
		FROMFROM = {
			holder_scope = {
				top_liege = {
					any_realm_character = {
						limit = {
							character = PREVPREV
						}
						if = {
							limit = {
								NOT = { intrigue = 6 }
							}
							random_list = {
								50 = { custom_tooltip = { text = "siege_escaped" } }
								40 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								10 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
							}
						}
						if = {
							limit = {
								intrigue = 6
								NOT = { intrigue = 12 }
							}
							random_list = {
								70 = { custom_tooltip = { text = "siege_escaped" } }
								25 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								5 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
							}
						}
						if = {
							limit = {
								intrigue = 12
							}
							random_list = {
								85 = { custom_tooltip = { text = "siege_escaped" } }
								13 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								2 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
							}
						}
					}
				}
				any_courtier = {
					limit = {
						at_location = FROMFROM
						prisoner = no
						NOT = { character = PREV }
						OR = {
							is_ruler = yes
							is_close_relative = PREV
							father = {
								is_ruler = yes
								is_alive = yes
							}
							mother = {
								is_ruler = yes
								is_alive = yes
							}
						}
					}
					if = {
						limit = {
							trait = in_hiding
							NOT = { intrigue = 6 }
						}
						random_list = {
							50 = { custom_tooltip = { text = "siege_escaped" } }
							40 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							10 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							trait = in_hiding
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							70 = { custom_tooltip = { text = "siege_escaped" } }
							25 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							5 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							NOT = { intrigue = 6 }
						}
						random_list = {
							20 = { custom_tooltip = { text = "siege_escaped" } }
							40 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							40 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							30 = { custom_tooltip = { text = "siege_escaped" } }
							50 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							20 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 12
							NOT = { intrigue = 18 }
						}
						random_list = {
							60 = { custom_tooltip = { text = "siege_escaped" } }
							30 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							10 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
				}
			}
		}
	}	 
	option = {
		name = "EVTOPTD_Plus_1021" #Leave them be.
		ai_chance = {
			factor = 1
			modifier = {
				factor = 10
				trait = kind
			}
			modifier = {
				factor = 3
				trait = charitable
			}
			modifier = {
				factor = 3
				trait = humble
			}
			modifier = {
				factor = 0.5
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = greedy
			}
			modifier = {
				factor = 0.5
				trait = cruel
			}	
		}
		hidden_tooltip = {
			if = {
				limit = { NOT = { trait = kind } }
				random = { 			
					chance = 10
					if = {
						limit = {
							NOT = { trait = kind }
							NOT = { trait = cruel }
						}
						add_trait = kind
						hidden_tooltip = { character_event = { id = 38268 } } # notify kind
					}
					if = {
						limit = { trait = cruel }
						remove_trait = cruel
					}
				}
			}
			if = {
				limit = { NOT = { trait = charitable } }
				random = { 			
					chance = 10
					if = {
						limit = {
							NOT = { trait = charitable }
							NOT = { trait = greedy }
						}
						add_trait = charitable
						character_event = { id = 38273 } # I am charitable!
					}
					if = {
						limit = { trait = greedy }
						remove_trait = greedy
					}
				}
			}
		}
		FROMFROM = {
			holder_scope = {
				any_courtier = {
					limit = {
						NOT = { trait = in_hiding }
						at_location = FROMFROM
						prisoner = no
						NOT = { character = PREV }
						OR = {
							is_ruler = yes
							is_close_relative = PREV
							father = {
								is_ruler = yes
								is_alive = yes
							}
							mother = {
								is_ruler = yes
								is_alive = yes
							}
						}
					}			
					opinion = {
						who = ROOT
						modifier = opinion_relieved
						months = 12
					}
				}
			}
		}
	}
}

# The enemy ruler is not present but there is family
character_event = {
	id = Plus.1023
	desc = EVTDESC_Plus_1023
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_war

	hide_from = yes
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTA_Plus_1023" #Grab anyone of importance we can find
		ai_chance = {
			factor = 0.5
			modifier = {
				factor = 0.1
				FROMFROM = { holder_scope = { primary_title = { lower_tier_than = COUNT } } }
			}
			modifier = {
				factor = 40
				FROMFROM = { holder_scope = { 
					any_dynasty_member = { primary_title = { higher_tier_than = COUNT } } } }
			}
			modifier = {
				factor = 100
				FROMFROM = { holder_scope = { 
					any_dynasty_member = { primary_title = { higher_tier_than = DUKE } } } }
			}
			modifier = {
				factor = 8
				trait = cruel
			}
			modifier = {
				factor = 8
				trait = greedy
			}
			modifier = {
				factor = 0
				trait = kind
			}
			modifier = {
				factor = 20
				trait = impaler
			}
			modifier = {
				factor = 20
				trait = wroth
			}	
		}
		if = {
			limit = { NOT = { trait = greedy } }
			random = { 			
				chance = 10
				if = {
					limit = {
						NOT = { trait = greedy }
						NOT = { trait = charitable }
					}
					add_trait = greedy
					character_event = { id = 38252 } # I am greedy!
				}
				if = {
					limit = { trait = charitable }
					remove_trait = charitable
				}
			}
		}
		FROMFROM = {
			holder_scope = {
				any_courtier = {
					limit = {
						at_location = FROMFROM
						prisoner = no
						NOT = { character = PREV }
						OR = {
							is_ruler = yes
							is_close_relative = PREV
							father = {
								is_ruler = yes
								is_alive = yes
							}
							mother = {
								is_ruler = yes
								is_alive = yes
							}
						}
					}
					if = {
						limit = {
							trait = in_hiding
							NOT = { intrigue = 6 }
						}
						random_list = {
							70 = { custom_tooltip = { text = "siege_escaped" } }
							20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							10 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							trait = in_hiding
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							85 = { custom_tooltip = { text = "siege_escaped" } }
							10 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							5 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							trait = in_hiding
							intrigue = 12
						}
						random_list = {
							93 = { custom_tooltip = { text = "siege_escaped" } }
							5 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							2 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							NOT = { intrigue = 6 }
						}
						random_list = {
							20 = { custom_tooltip = { text = "siege_escaped" } }
							20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							60 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							30 = { custom_tooltip = { text = "siege_escaped" } }
							30 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							40 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 12
							NOT = { intrigue = 18 }
						}
						random_list = {
							60 = { custom_tooltip = { text = "siege_escaped" } }
							20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							20 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 18
						}
						random_list = {
							80 = { custom_tooltip = { text = "siege_escaped" } }
							10 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							10 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
				}
			}
		}
	}
	option = {
		name = "EVTOPTC_Plus_1022" #Kill everyone you can find
		trigger = {
			NOR = {
				trait = just
				trait = kind
			}
		}
		ai_chance = {
			factor = 0.5
			modifier = {
				factor = 0
				FROMFROM = {
					holder_scope = {
						ROOT = {
							independent = no
							liege = {
								OR = {
									is_close_relative = PREVPREV
									dynasty = PREVPREV
								}
							}
						}
					}
				}
			}
			modifier = {
				factor = 0
				FROMFROM = {
					holder_scope = { is_close_relative = ROOT }
				}
			}
			modifier = {
				factor = 0.1
				FROMFROM = {
					holder_scope = { dynasty = ROOT }
				}
			}
			modifier = {
				factor = 20
				trait = cruel
			}
			modifier = {
				factor = 10
				trait = arbitrary
			}
			modifier = {
				factor = 0.5
				trait = diligent
			}
			modifier = {
				factor = 20
				trait = impaler
			}
			modifier = {
				factor = 20
				trait = wroth
			}
			modifier = {
				factor = 0.3
				trait = charitable
			}
			modifier = {
				factor = 0.3
				trait = humble
			}
			modifier = {
				factor = 0.5
				trait = honest
			}
		}
		if = {
			limit = { NOT  = { lifestyle_traits = 1 } }
			add_trait = impaler
		}		
		if = {
			limit = { NOT = { trait = cruel } }
			random = { 			
				chance = 50
				add_trait = cruel
				hidden_tooltip = { character_event = { id = 38259 } } # I am cruel!
			}
		}
		if = {
			limit = { NOT = { trait = arbitrary } }
			random = { 			
				chance = 20
				add_trait = arbitrary
				hidden_tooltip = { character_event = { id = 38266 } } # I am arbitrary!
			}
		}
		if = {
			limit = {
				trait = dishonorable9
			}
			remove_trait = dishonorable9
			add_trait = dishonorable10
		}
		if = {
			limit = {
				trait = dishonorable8
			}
			remove_trait = dishonorable8
			add_trait = dishonorable9
		}
		if = {
			limit = {
				trait = dishonorable7
			}
			remove_trait = dishonorable7
			add_trait = dishonorable8
		}
		if = {
			limit = {
				trait = dishonorable6
			}
			remove_trait = dishonorable6
			add_trait = dishonorable7
		}
		if = {
			limit = {
				trait = dishonorable5
			}
			remove_trait = dishonorable5
			add_trait = dishonorable6
		}
		if = {
			limit = {
				trait = dishonorable4
			}
			remove_trait = dishonorable4
			add_trait = dishonorable5
		}
		if = {
			limit = {
				trait = dishonorable3
			}
			remove_trait = dishonorable3
			add_trait = dishonorable4
		}
		if = {
			limit = {
				trait = dishonorable2
			}
			remove_trait = dishonorable2
			add_trait = dishonorable3
		}
		if = {
			limit = {
				trait = dishonorable1
			}
			remove_trait = dishonorable1
			add_trait = dishonorable2
		}
		if = {
			limit = {
				trait = dyn_dishonorable9
			}
			remove_trait = dyn_dishonorable9
			add_trait = dishonorable10
		}
		if = {
			limit = {
				trait = dyn_dishonorable8
			}
			remove_trait = dyn_dishonorable8
			add_trait = dishonorable9
		}
		if = {
			limit = {
				trait = dyn_dishonorable7
			}
			remove_trait = dyn_dishonorable7
			add_trait = dishonorable8
		}
		if = {
			limit = {
				trait = dyn_dishonorable6
			}
			remove_trait = dyn_dishonorable6
			add_trait = dishonorable7
		}
		if = {
			limit = {
				trait = dyn_dishonorable5
			}
			remove_trait = dyn_dishonorable5
			add_trait = dishonorable6
		}
		if = {
			limit = {
				trait = dyn_dishonorable4
			}
			remove_trait = dyn_dishonorable4
			add_trait = dishonorable5
		}
		if = {
			limit = {
				trait = dyn_dishonorable3
			}
			remove_trait = dyn_dishonorable3
			add_trait = dishonorable4
		}
		if = {
			limit = {
				trait = dyn_dishonorable2
			}
			remove_trait = dyn_dishonorable2
			add_trait = dishonorable3
		}
		if = {
			limit = {
				trait = dyn_dishonorable1
			}
			remove_trait = dyn_dishonorable1
			add_trait = dishonorable2
		}
		if = {
			limit = {
				NOT = { trait = dishonorable1 }
				NOT = { trait = dishonorable2 }
				NOT = { trait = dishonorable3 }
				NOT = { trait = dishonorable4 }
				NOT = { trait = dishonorable5 }
				NOT = { trait = dishonorable6 }
				NOT = { trait = dishonorable7 }
				NOT = { trait = dishonorable8 }
				NOT = { trait = dishonorable9 }
				NOT = { trait = dishonorable10 }
				NOT = { trait = dyn_dishonorable1 }
				NOT = { trait = dyn_dishonorable2 }
				NOT = { trait = dyn_dishonorable3 }
				NOT = { trait = dyn_dishonorable4 }
				NOT = { trait = dyn_dishonorable5 }
				NOT = { trait = dyn_dishonorable6 }
				NOT = { trait = dyn_dishonorable7 }
				NOT = { trait = dyn_dishonorable8 }
				NOT = { trait = dyn_dishonorable9 }
				NOT = { trait = dyn_dishonorable10 }
			}
			add_trait = dishonorable1
		}
		FROMFROM = {
			holder_scope = {
				any_courtier = {
					limit = {
						at_location = FROMFROM
						prisoner = no
						NOT = { character = PREV }
						OR = {
							is_ruler = yes
							is_close_relative = PREV
							father = {
								is_ruler = yes
								is_alive = yes
							}
							mother = {
								is_ruler = yes
								is_alive = yes
							}
						}
					}
					if = {
						limit = {
							trait = in_hiding
							NOT = { intrigue = 6 }
						}
						random_list = {
							50 = { custom_tooltip = { text = "siege_escaped" } }
							40 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							10 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							trait = in_hiding
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							70 = { custom_tooltip = { text = "siege_escaped" } }
							25 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							5 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							trait = in_hiding
							intrigue = 12
						}
						random_list = {
							85 = { custom_tooltip = { text = "siege_escaped" } }
							13 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							2 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							NOT = { intrigue = 6 }
						}
						random_list = {
							20 = { custom_tooltip = { text = "siege_escaped" } }
							40 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							40 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							30 = { custom_tooltip = { text = "siege_escaped" } }
							50 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							20 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 12
							NOT = { intrigue = 18 }
						}
						random_list = {
							60 = { custom_tooltip = { text = "siege_escaped" } }
							30 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							10 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 18
						}
						random_list = {
							70 = { custom_tooltip = { text = "siege_escaped" } }
							25 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							5 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
				}
			}
		}
	}	 
	option = {
		name = "EVTOPTC_Plus_1023" #Leave them be.
		ai_chance = {
			factor = 1
			modifier = {
				factor = 10
				trait = kind
			}
			modifier = {
				factor = 3
				trait = charitable
			}
			modifier = {
				factor = 3
				trait = humble
			}
			modifier = {
				factor = 0.5
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = greedy
			}
			modifier = {
				factor = 0.5
				trait = cruel
			}	
		}
		if = {
			limit = { NOT = { trait = kind } }
			random = { 			
				chance = 10
				if = {
					limit = {
						NOT = { trait = kind }
						NOT = { trait = cruel }
					}
					add_trait = kind
					hidden_tooltip = { character_event = { id = 38268 } } # notify kind
				}
				if = {
					limit = { trait = cruel }
					remove_trait = cruel
				}
			}
		}
		if = {
			limit = { NOT = { trait = charitable } }
			random = { 			
				chance = 10
				if = {
					limit = {
						NOT = { trait = charitable }
						NOT = { trait = greedy }
					}
					add_trait = charitable
					character_event = { id = 38273 } # I am charitable!
				}
				if = {
					limit = { trait = greedy }
					remove_trait = greedy
				}
			}
		}
		FROMFROM = {
			holder_scope = {
				any_courtier = {
					limit = {
						at_location = FROMFROM
						prisoner = no
						NOT = { character = PREV }
						OR = {
							is_ruler = yes
							is_close_relative = PREV
							father = {
								is_ruler = yes
								is_alive = yes
							}
							mother = {
								is_ruler = yes
								is_alive = yes
							}
						}
					}
					opinion = {
						who = ROOT
						modifier = opinion_relieved
						months = 12
					}
				}
			}
		}
	}
}

# Attacker gets the option to release any prisoners within
character_event = {
	id = Plus.1024
	desc = EVTDESC_Plus_1024
	picture = GFX_evt_into_the_dungeon
	border = GFX_event_normal_frame_war
	
	hide_from = yes
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_Plus_1024 #Release all prisoners
		trigger = {
			FROMFROM = {
				holder_scope = {
					war_with = ROOT
					any_courtier = { prisoner = yes }
				}
			}
		}
		ai_chance = { 
			factor = 0.25
			modifier = {
				factor = 2
				trait = kind
			}
			modifier = {
				factor = 2
				trait = trusting
			}
			modifier = {
				factor = 0
				OR = {
					trait = cruel
					trait = greedy
				}
			}
			modifier = {
				factor = 2
				trait = charitable
			}
			modifier = {
				factor = 0.5
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = cynical
			}
			modifier = {
				factor = 0.5
				trait = paranoid
			}
		}
		random = {
			chance = 10
			if = {
				limit = {
					NOT = { trait = kind }
					NOT = { trait = cruel }
				}
				add_trait = kind
				hidden_tooltip = { character_event = { id = 38268 } } # I am kind!
			}
			if = {
				limit = { trait = cruel }
				remove_trait = cruel
			}
		}
		random = {
			chance = 10
			if = {
				limit = {
					NOT = { trait = charitable }
					NOT = { trait = greedy }
				}
				add_trait = charitable
				hidden_tooltip = { character_event = { id = 38273 } } # I am charitable!
			}
			if = {
				limit = { trait = greedy }
				remove_trait = greedy
			}
		}
		FROMFROM = {
			holder_scope = {
				any_courtier = {	
					limit = {
						at_location = FROMFROM
						prisoner = yes
					}
					prisoner = no
				}
			}
		}	
	}
	option = {
		name = EVTOPTB_Plus_1024 #Transfer them to my dungeon!
		trigger = {
			FROMFROM = {
				holder_scope = {
					war_with = ROOT
					any_courtier = { prisoner = yes }
					NOT = {
						any_courtier = {
							prisoner = yes
							OR = {
								dynasty = ROOT
								is_close_relative = ROOT
							}
						}
					}
				}
			}
		}
		ai_chance = { 
			factor = 0.1 
			modifier = {
				factor = 0
				OR = {
					trait = kind
					trait = charitable
				}
			}
			modifier = {
				factor = 0.1
				trait = just
			}
			modifier = {
				factor = 10
				trait = ambitious
			}
			modifier = {
				factor = 10
				trait = cruel
			}
			modifier = {
				factor = 10
				trait = greedy
			}
			modifier = {
				factor = 5
				trait = wroth
			}
			modifier = {
				factor = 5
				trait = cynical
			}
			modifier = {
				factor = 5
				trait = paranoid
			} 
		}
		random = {
			chance = 10
			if = {
				limit = {
					NOT = { trait = kind }
					NOT = { trait = cruel }
				}
				add_trait = cruel
				hidden_tooltip = { character_event = { id = 38259 } } # I am cruel!
			}
			if = {
				limit = { trait = kind }
				remove_trait = kind
			}
		}
		random = {
			chance = 10
			if = {
				limit = {
					NOT = { trait = charitable }
					NOT = { trait = greedy }
				}
				add_trait = greedy
				hidden_tooltip = { character_event = { id = 38252 } } # I am greedy!
			}
			if = {
				limit = { trait = charitable }
				remove_trait = charitable
			}
		}
		FROMFROM = {
			holder_scope = {
				any_courtier = {	
					limit = {
						at_location = FROMFROM
						prisoner = yes
					}
					custom_tooltip = {
						text = MOVED_TO_MY_DUNGEON
						hidden_tooltip = {
							prisoner = no
							imprison = ROOT
						}
					}
					opinion = {
						who = ROOT
						modifier = opinion_angry
						months = 60
					}
				}
			}
		}	
	}
	option = {
		name = EVTOPTC_Plus_1024 #Release anyone within whom we have common cause
		trigger = {
			FROMFROM = {
				holder_scope = {
					war_with = ROOT
					any_courtier = {
						prisoner = yes
						war_with = PREV
					}
					any_courtier = {
						prisoner = yes
						NOT = { war_with = PREV }
					}
				}
			}
		}
		ai_chance = { 
			factor = 1.5 
			modifier = {
				factor = 2
				trait = kind
			}
			modifier = {
				factor = 2
				trait = trusting
			}
			modifier = {
				factor = 2
				trait = just
			}
			modifier = {
				factor = 0.5
				trait = cruel
			}
			modifier = {
				factor = 0.5
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = cynical
			}
			modifier = {
				factor = 0.5
				trait = paranoid
			} 
		}
		hidden_tooltip = {
			random = { 		
				chance = 10
				if = {
					limit = {
						NOT = { trait = just }
						NOT = { trait = arbitrary }
					}
					add_trait = just
					character_event = { id = 38267 } #I am just!
				}
				if = {
					limit = { trait = arbitrary }
					remove_trait = arbitrary
				}
			}
		}
		FROMFROM = {
			holder_scope = {
				any_courtier = {	
					limit = {
						prisoner = yes
						war_with = PREV
					}
					prisoner = no
				}
			}
		}
	}
	option = {
		name = EVTOPTD_Plus_1024 #Release only my relatives
		trigger = {
			FROMFROM = {
				holder_scope = {
					war_with = ROOT
					any_courtier = {
						prisoner = yes
						OR = {
							is_close_relative = ROOT
							dynasty = ROOT
						}
					}
					any_courtier = {
						prisoner = yes
						NOT = { is_close_relative = ROOT }
						NOT = { dynasty = ROOT }
					}
				}
			}
		}
		ai_chance = { 
			factor = 0.75
			modifier = {
				factor = 0.9
				trait = kind
			}
			modifier = {
				factor = 0.9
				trait = trusting
			}
			modifier = {
				factor = 0.75
				trait = just
			}
			modifier = {
				factor = 1.5
				trait = cruel
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 2
				trait = cynical
			}
			modifier = {
				factor = 2
				trait = paranoid
			}
		}
		hidden_tooltip = {
			random = { 			
				chance = 10
				if = {
					limit = {
						NOT = { trait = paranoid }
						NOT = { trait = trusting }
					}
					add_trait = paranoid
					character_event = { id = 38275 } # I am paranoid!
				}
				if = {
					limit = { trait = trusting }
					remove_trait = trusting
				}
			}
		}
		FROMFROM = {
			holder_scope = {
				any_courtier = {	
					limit = {
						prisoner = yes
						OR = {
							is_close_relative = ROOT
							dynasty = ROOT
						}
					}
					prisoner = no
				}
			}
		}
	}
	option = {
		name = EVTOPTE_Plus_1024 #Leave them	
		trigger = {
			FROMFROM = {
				holder_scope = {
					war_with = ROOT
					any_courtier = { prisoner = yes }
				}
			}
		}
		ai_chance = { 
			factor = 0.01 
			modifier = {
				factor = 0.1
				trait = kind
			}
			modifier = {
				factor = 0.1
				trait = just
			}
			modifier = {
				factor = 10
				trait = ambitious
			}
			modifier = {
				factor = 10
				trait = cruel
			}
			modifier = {
				factor = 10
				trait = wroth
			}
			modifier = {
				factor = 10
				trait = cynical
			}
			modifier = {
				factor = 10
				trait = paranoid
			} 
		}	
		hidden_tooltip = {
			random = { 			
				chance = 20
				if = {
					limit = {
						NOT = { trait = cruel }
						NOT = { trait = kind }
					}
					add_trait = cruel
					character_event = { id = 38259 } # I am cruel!
				}
				if = {
					limit = { trait = kind }
					remove_trait = kind
				}
			}
		}
		FROMFROM = {
			holder_scope = {
				any_courtier = {	
					limit = {
						at_location = FROMFROM
						prisoner = yes
					}
					opinion = {
						who = ROOT
						modifier = left_to_rot
						months = 60
					}
				}
			}
		}
	}
}

# When liberating a friendly castle
character_event = {
	id = Plus.1025
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		rebel = no
		is_looting = no
		NOR = {
			has_landed_title = e_rebels
			has_landed_title = e_mexikha
			any_liege = { has_landed_title = e_mexikha }
		}
		FROM = {
			holder_scope = {
				NOT = { war_with = ROOT }
				NOT = { character = ROOT }
			}
		}
	}
	
	immediate = {
		prestige = 10
		FROM = { 
			holder_scope = {
				if = {
					limit = { at_location = ROOT }
					opinion = {
						who = ROOT
						modifier = liberated
						months = 12
					}
					remove_character_modifier = stalwart_defender
					remove_character_modifier = left_at_siege
				}
				any_courtier = { 
					if = {
						limit = { 
							at_location = ROOT 
							NOT = { war_with = ROOT }
						}
						opinion = {
							who = ROOT
							modifier = liberated
							months = 12
						}
						remove_character_modifier = stalwart_defender
						remove_character_modifier = left_at_siege
					}
				}
			}
		}
	}
}

# Character notified that they were killed by siege
character_event = {
	id = Plus.1026
	desc = "EVTDESC_Plus_1026"
	picture = "GFX_evt_siege"
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTA_Plus_1026"
		death = { death_reason = death_battle killer = FROM }
		hidden_tooltip = {
			FROM = {
				if = {
					limit = {
						NOT = { religion_group = muslim }
						is_close_relative = ROOT
						NOT = { trait = immortal }
					}
					add_trait = kinslayer
				}
				if = {
					limit = {
						dynasty = ROOT
						religion_group = muslim
						dynasty_head = { character = FROM }
					}
					decadence = 1
				}
				if = {
					limit = {
						spouse = { character = ROOT }
					}
					spouse = {
						any_dynasty_member = {
							limit = {
								is_alive = yes
								NOT = { character = FROM }
								NOT = { has_opinion_modifier = { who = FROM modifier = executed_kin } }
							}
							opinion = {
								who = FROM
								modifier = executed_kin
								months = 1200
							}
						}
					}
				}
			}
			ROOT = {
				if = {
					limit = {
						NOT = { mother = { character = FROM } }
					}
					mother = {
						opinion = {
							who = FROM
							modifier = executed_kin
							months = 120
						}
					}
				}
				if = {
					limit = {
						NOT = { father = { character = FROM } }
					}
					father = {
						opinion = {
							who = FROM
							modifier = executed_kin
							months = 120
						}
					}
				}
				any_sibling = {
					limit = {
						NOT = { character = FROM }
					}
					opinion = {
						who = FROM
						modifier = executed_kin
						months = 120
					}
				}
				any_child = {
					limit = {
						NOT = { character = FROM }
					}
					opinion = {
						who = FROM
						modifier = executed_kin
						months = 120
					}
				}
			}
		}
	}
}

# Character notified that they were taken prisoner during siege
character_event = {
	id = Plus.1027
	desc = "EVTDESC_Plus_1027"
	picture = "GFX_evt_into_the_dungeon"
	border = "GFX_event_normal_frame_war"

	is_triggered_only = yes
	
	option = {
		name = "CURSES"
		imprison = FROM
	}
}

# For characters in the siege who are not close family but important enough to be captured
character_event = {
	id = Plus.1028
	desc = "EVTDESC62100"
	picture = "GFX_evt_siege"
	border = "GFX_event_normal_frame_war"

	is_triggered_only = yes

	trigger = {
		new_character = {
			rebel = no
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
				FROM = { holder_scope = { religion = ROOT } }
			}
			NOR = {
				has_landed_title = e_rebels
				has_landed_title = e_mexikha
				any_liege = {
					has_landed_title = e_mexikha
				}
			}
		}
		FROM = {
			holder_scope = {
				OR = {
					capital_scope = {
						ROOT = {
							location = { province_id = PREVPREV }
						}
					}
					AND = {
						primary_title = { tier = BARON }
						NOT = { num_of_baron_titles = 2 }
					}
				}		
			}
		}
		NOT = {
			FROM = {
				holder_scope = {
					OR = {
						character = ROOT
						is_close_relative = ROOT
					}
				}
			}
		}
		OR = {
			is_ruler = yes
			father = { is_ruler = yes }
			mother = { is_ruler = yes }
			is_consort = yes
		}
	}

	weight_multiplier = {
		days = 1
		modifier = {
			factor = 0.1
			trait = in_hiding
		}
		modifier = {
			factor = 1.2
			NOT = { intrigue = 4 }
		}
		modifier = {
			factor = 0.8
			intrigue = 8
		}
		modifier = {
			factor = 0.8
			intrigue = 10
		}
		modifier = {
			factor = 0.8
			intrigue = 12
		}
		modifier = {
			factor = 0.8
			intrigue = 14
		}
		modifier = {
			factor = 0.8
			intrigue = 16
		}
		modifier = {
			factor = 5.0
			is_ruler = yes
		}
		modifier = {
			factor = 2.0
			OR = { higher_tier_than = baron is_patrician = yes }
		}
		modifier = {
			factor = 1.25
			trait = brave
		}
		modifier = {
			factor = 0.25
			trait = craven
		}
		modifier = {
			factor = 0.25
			trait = paranoid
		}

		modifier = {
			factor = 1.25
			trait = stressed
		}
		modifier = {
			factor = 1.5
			trait = depressed
		}
		modifier = {
			factor = 3.0
			trait = lunatic
		}
		modifier = {
			factor = 2.0
			trait = possessed
		}
		modifier = {
			factor = 1.1
			trait = ill
		}
		modifier = {
			factor = 1.25
			trait = pneumonic
		}
		modifier = {
			factor = 1.25
			trait = syphilitic
		}
		modifier = {
			factor = 2.0
			trait = leper
		}
		modifier = {
			factor = 1.15
			trait = wounded
		}
		modifier = {
			factor = 1.25
			trait = maimed
		}
		modifier = {
			factor = 2.0
			trait = infirm
		}
		modifier = {
			factor = 3.0
			trait = incapable
		}
		modifier = {
			factor = 1.1
			trait = drunkard
		}
		modifier = {
			factor = 1.1
			trait = has_tuberculosis
		}
		modifier = {
			factor = 1.1
			trait = has_typhoid_fever
		}
		modifier = {
			factor = 1.5
			trait = has_typhus
		}
		modifier = {
			factor = 1.5
			trait = has_bubonic_plague
		}
		modifier = {
			factor = 1.1
			trait = has_measles
		}
		modifier = {
			factor = 1.1
			trait = has_small_pox
		}
		modifier = {
			factor = 5
			is_female = yes
			is_ruler = no
			new_character = {
				OR = {
					religion_group = pagan_group
					religion_group = zoroastrian_group
				}
			}
		}
	}

	option = {
		name = EVTOPTA62100
		new_character = {
			ROOT = {
				imprison = PREV
			}
		}
		hidden_tooltip = {
			new_character = {
				character_event = { id = Plus.1029 }
			}
		}
	}
}

# Siege winner informed of capture
character_event = {
	id = Plus.1029
	desc = "EVTDESC_Plus_1029"
	picture = "GFX_evt_siege"
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes

	notification = yes
	
	ai = no	
	
	option = {
		name = EVTOPTA62101
		tooltip = {
			FROM = {
				imprison = yes
			}
		}
	}
}

# Unit leader at the siege gets the main imprisonment event (if unreformed pagan)
character_event = {
	id = Plus.1030
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		rebel = no
		NOR = {
			has_landed_title = e_rebels
			has_landed_title = e_mexikha
			any_liege = { has_landed_title = e_mexikha }
		}
		religion_group = pagan_group
		is_reformed_religion = no
		FROM = {
			holder_scope = {
				NOT = { religion = ROOT }
				war_with = ROOT
				NOT = { character = ROOT }
				capital_scope = {
					ROOT = {
						location = {
							province_id = PREVPREV
						}
					}
				}
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				is_ruler = no
				liege = {
					FROM = {
						holder_scope = { war_with = PREVPREV }
					}
				}
			}
			top_liege = {
				any_realm_character = {
					limit = {
						is_adult = yes
						at_location = ROOT
						prisoner = no
					}
					set_character_flag = wants_to_loot
				}
			}
			liege = {
				character_event = { id = Plus.1031 } # Base post-looting event
			}
			FROM = {
				holder_scope = {
					if = {
						limit = {
							any_courtier = {
								prisoner = yes
								at_location = ROOT
							}
						}
						ROOT = {
							liege = {
								character_event = { id = Plus.1024 } # prisoners present
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				is_ruler = yes
			}
			top_liege = {
				any_realm_character = {
					limit = {
						is_adult = yes
						at_location = ROOT
						prisoner = no
					}
					set_character_flag = wants_to_loot
				}
			}
			character_event = { id = Plus.1031 } # Base post-looting event
			FROM = {
				holder_scope = {
					if = {
						limit = {
							any_courtier = {
								prisoner = yes
								at_location = ROOT
							}
						}
						ROOT = {
							character_event = { id = Plus.1024 } # prisoners present
						}
					}
				}
			}
		}
	}
}

# Post-looting event for unreformed pagans
character_event = {
	id = Plus.1031
	desc = EVTDESC_Plus_1031
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_war

	is_triggered_only = yes
	hide_from = yes
	
	option = {
		name = EVTOPTA_Plus_1031 #I want prisoners
		trigger = {
			FROMFROM = {
				holder_scope = {
					OR = {
						at_location = FROMFROM
						any_courtier = {
							at_location = FROMFROM
							war_with = ROOT
							prisoner = no
							NOT = { character = PREV }
							OR = {
								is_ruler = yes
								is_consort = yes
								father = { is_ruler = yes }
								mother = { is_ruler = yes }
								any_sibling = { is_ruler = yes }
								is_close_relative = PREV
								wealth = 100
								AND = {
									is_female = yes
									is_adult = yes
									NOR = {
										age = 30
										dynasty = none
										trait = ugly
									}
								}
							}
						}
					}
				}
			}
		}
		ai_chance = {
			factor = 40
			modifier = {
				factor = 2
				trait = greedy
			}
			modifier = {
				factor = 1.5
				trait = envious
			}
		}
		prestige = -20
		custom_tooltip = {
			text = MEN_ARE_ANGERED
			hidden_tooltip = {
				top_liege = {
					any_realm_character = {
						limit = { has_character_flag = wants_to_loot }
						opinion = {
							who = ROOT
							modifier = not_allowed_to_loot
							months = 24
						}
					}
				}
			}
		}
		FROMFROM = {
			holder_scope = {
				top_liege = {
					any_realm_character = {
						limit = {
							character = PREVPREV
							at_location = FROMFROM
						}
						if = {
							limit = {
								trait = in_hiding
								NOT = { intrigue = 6 }
							}
							random_list = {
								70 = { custom_tooltip = { text = "siege_escaped" } }
								20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								10 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
						if = {
							limit = {
								trait = in_hiding
								intrigue = 6
								NOT = { intrigue = 12 }
							}
							random_list = {
								85 = { custom_tooltip = { text = "siege_escaped" } }
								10 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								5 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
						if = {
							limit = {
								NOT = { trait = in_hiding }
								NOT = { intrigue = 6 }
							}
							random_list = {
								20 = { custom_tooltip = { text = "siege_escaped" } }
								40 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								40 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
						if = {
							limit = {
								NOT = { trait = in_hiding }
								intrigue = 6
								NOT = { intrigue = 12 }
							}
							random_list = {
								40 = { custom_tooltip = { text = "siege_escaped" } }
								40 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								20 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
						if = {
							limit = {
								NOT = { trait = in_hiding }
								intrigue = 12
								NOT = { intrigue = 18 }
							}
							random_list = {
								70 = { custom_tooltip = { text = "siege_escaped" } }
								20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								10 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							}
						}
					}
				}
				any_courtier = {
					limit = {
						at_location = FROMFROM
						war_with = ROOT
						prisoner = no
						NOT = { character = PREV }
						OR = {
							is_ruler = yes
							is_consort = yes
							father = { is_ruler = yes }
							mother = { is_ruler = yes }
							any_sibling = { is_ruler = yes }
							is_close_relative = PREV
							wealth = 100
							AND = {
								is_female = yes
								is_adult = yes
								NOR = {
									age = 30
									dynasty = none
									trait = ugly
								}
							}
						}
					}
					if = {
						limit = {
							trait = in_hiding
							NOT = { intrigue = 6 }
						}
						random_list = {
							70 = { custom_tooltip = { text = "siege_escaped" } }
							20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							10 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							trait = in_hiding
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							85 = { custom_tooltip = { text = "siege_escaped" } }
							10 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							5 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							NOT = { intrigue = 6 }
						}
						random_list = {
							20 = { custom_tooltip = { text = "siege_escaped" } }
							40 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							40 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							40 = { custom_tooltip = { text = "siege_escaped" } }
							40 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							20 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 12
							NOT = { intrigue = 18 }
						}
						random_list = {
							70 = { custom_tooltip = { text = "siege_escaped" } }
							20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							10 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
						}
					}
				}
			}
		}
		hidden_tooltip = {
			top_liege = {
				any_realm_character = {
					limit = { has_character_flag = wants_to_loot }
					clr_character_flag = wants_to_loot
				}
			}
		}
	}
	option = {
		name = EVTOPTB_Plus_1031 #Let them celebrate
		ai_chance = {
			factor = 40
			modifier = {
				factor = 1.5
				trait = lustful
			}
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 1.5
				trait = kind
			}
		}
		FROMFROM = {
			holder_scope = {
				top_liege = {
					any_realm_character = {
						limit = {
							character = PREVPREV
							at_location = FROMFROM
						}
						if = {
							limit = {
								trait = in_hiding
								NOT = { intrigue = 6 }
							}
							random_list = {
								80 = { custom_tooltip = { text = "siege_escaped" } }
								10 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								5 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
								5 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
							}
						}
						if = {
							limit = {
								trait = in_hiding
								intrigue = 6
								NOT = { intrigue = 12 }
							}
							random_list = {
								90 = { custom_tooltip = { text = "siege_escaped" } }
								5 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								3 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
								2 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
							}
						}
						if = {
							limit = {
								NOT = { trait = in_hiding }
								NOT = { intrigue = 6 }
							}
							random_list = {
								40 = { custom_tooltip = { text = "siege_escaped" } }
								20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								20 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
								20 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
							}
						}
						if = {
							limit = {
								NOT = { trait = in_hiding }
								intrigue = 6
								NOT = { intrigue = 12 }
							}
							random_list = {
								60 = { custom_tooltip = { text = "siege_escaped" } }
								20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								10 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
								10 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
							}
						}
						if = {
							limit = {
								NOT = { trait = in_hiding }
								intrigue = 12
								NOT = { intrigue = 18 }
							}
							random_list = {
								80 = { custom_tooltip = { text = "siege_escaped" } }
								10 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								5 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
								5 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
							}
						}
					}
				}
				any_courtier = {
					limit = {
						at_location = FROMFROM
						war_with = ROOT
						prisoner = no
						NOT = { character = PREV }
						OR = {
							is_ruler = yes
							is_consort = yes
							father = { is_ruler = yes }
							mother = { is_ruler = yes }
							any_sibling = { is_ruler = yes }
							is_close_relative = PREV
							wealth = 100
							AND = {
								is_female = yes
								is_adult = yes
								NOR = {
									age = 30
									dynasty = none
									trait = ugly
								}
							}
						}
					}
					if = {
						limit = {
							trait = in_hiding
							NOT = { intrigue = 6 }
						}
						random_list = {
							80 = { custom_tooltip = { text = "siege_escaped" } }
							10 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							5 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							5 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							trait = in_hiding
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							90 = { custom_tooltip = { text = "siege_escaped" } }
							5 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							3 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							2 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							NOT = { intrigue = 6 }
						}
						random_list = {
							40 = { custom_tooltip = { text = "siege_escaped" } }
							20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							20 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							20 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							60 = { custom_tooltip = { text = "siege_escaped" } }
							20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							10 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							10 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 12
							NOT = { intrigue = 18 }
						}
						random_list = {
							80 = { custom_tooltip = { text = "siege_escaped" } }
							10 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							5 = { character_event = { id = Plus.1027 tooltip = "siege_captured" } }
							5 = { character_event = { id = Plus.1026 tooltip = "siege_killed" } }
						}
					}
				}
			}
		}
		hidden_tooltip = {
			top_liege = {
				any_realm_character = {
					limit = { has_character_flag = wants_to_loot }
					clr_character_flag = wants_to_loot
				}
			}
		}
	}
	option = {
		name = EVTOPTC_Plus_1031 #Tonight we offer sacrifices!
		trigger = {
			FROMFROM = {
				holder_scope = {
					OR = {
						at_location = FROMFROM
						any_courtier = {
							at_location = FROMFROM
							war_with = ROOT
							prisoner = no
							NOT = { character = PREV }
							OR = {
								is_ruler = yes
								is_consort = yes
								father = { is_ruler = yes }
								mother = { is_ruler = yes }
								any_sibling = { is_ruler = yes }
								is_close_relative = PREV
								wealth = 100
								AND = {
									is_female = yes
									is_adult = yes
									NOR = {
										age = 30
										dynasty = none
										trait = ugly
									}
								}
							}
						}
					}
				}
			}
		}
		ai_chance = {
			factor = 20
			modifier = {
				factor = 4
				trait = zealous
			}
			modifier = {
				factor = 0.5
				trait = cynical
			}
		}
		piety = 20
		custom_tooltip = {
			text = MEN_ARE_PLEASED
			hidden_tooltip = {	
				top_liege = {
					any_realm_character = {
						limit = { has_character_flag = wants_to_loot }
						opinion = {
							who = ROOT
							modifier = loot_sacrifice
							months = 24
						}
					}
				}
			}
		}
		custom_tooltip = {
			text = ENEMY_REALM_HORRIFIED
			hidden_tooltip = {
				FROMFROM = {
					holder_scope = {
						top_liege = {
							opinion = {
								who = ROOT
								modifier = opinion_barbarian
								months = 60
							}
							any_realm_character = {
								limit = {
									NOT = { religion_group = ROOT }
									NOT = { character = PREV }
								}
								opinion = {
									who = ROOT
									modifier = opinion_barbarian
									months = 60
								}
							}
						}
					}
				}
			}
		}
		FROMFROM = {
			holder_scope = {
				top_liege = {
					any_realm_character = {
						limit = {
							character = PREVPREV
							at_location = FROMFROM
						}
						if = {
							limit = {
								trait = in_hiding
								NOT = { intrigue = 6 }
							}
							random_list = {
								70 = { custom_tooltip = { text = "siege_escaped" } }
								20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								10 = { character_event = { id = Plus.1033 tooltip = "siege_sacrificed" } }
							}
						}
						if = {
							limit = {
								trait = in_hiding
								intrigue = 6
								NOT = { intrigue = 12 }
							}
							random_list = {
								85 = { custom_tooltip = { text = "siege_escaped" } }
								10 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								5 = { character_event = { id = Plus.1033 tooltip = "siege_sacrificed" } }
							}
						}
						if = {
							limit = {
								NOT = { trait = in_hiding }
								NOT = { intrigue = 6 }
							}
							random_list = {
								30 = { custom_tooltip = { text = "siege_escaped" } }
								30 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								40 = { character_event = { id = Plus.1033 tooltip = "siege_sacrificed" } }
							}
						}
						if = {
							limit = {
								NOT = { trait = in_hiding }
								intrigue = 6
								NOT = { intrigue = 12 }
							}
							random_list = {
								40 = { custom_tooltip = { text = "siege_escaped" } }
								40 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								20 = { character_event = { id = Plus.1033 tooltip = "siege_sacrificed" } }
							}
						}
						if = {
							limit = {
								NOT = { trait = in_hiding }
								intrigue = 12
								NOT = { intrigue = 18 }
							}
							random_list = {
								70 = { custom_tooltip = { text = "siege_escaped" } }
								20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
								10 = { character_event = { id = Plus.1033 tooltip = "siege_sacrificed" } }
							}
						}
					}
				}
				any_courtier = {
					limit = {
						at_location = FROMFROM
						war_with = ROOT
						prisoner = no
						NOT = { character = PREV }
						OR = {
							is_ruler = yes
							is_consort = yes
							father = { is_ruler = yes }
							mother = { is_ruler = yes }
							any_sibling = { is_ruler = yes }
							is_close_relative = PREV
							wealth = 100
							AND = {
								is_female = yes
								is_adult = yes
								NOR = {
									age = 30
									dynasty = none
									trait = ugly
								}
							}
						}
					}
					if = {
						limit = {
							trait = in_hiding
							NOT = { intrigue = 6 }
						}
						random_list = {
							70 = { custom_tooltip = { text = "siege_escaped" } }
							20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							10 = { character_event = { id = Plus.1033 tooltip = "siege_sacrificed" } }
						}
					}
					if = {
						limit = {
							trait = in_hiding
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							85 = { custom_tooltip = { text = "siege_escaped" } }
							10 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							5 = { character_event = { id = Plus.1033 tooltip = "siege_sacrificed" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							NOT = { intrigue = 6 }
						}
						random_list = {
							30 = { custom_tooltip = { text = "siege_escaped" } }
							30 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							40 = { character_event = { id = Plus.1033 tooltip = "siege_sacrificed" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 6
							NOT = { intrigue = 12 }
						}
						random_list = {
							40 = { custom_tooltip = { text = "siege_escaped" } }
							40 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							20 = { character_event = { id = Plus.1033 tooltip = "siege_sacrificed" } }
						}
					}
					if = {
						limit = {
							NOT = { trait = in_hiding }
							intrigue = 12
							NOT = { intrigue = 18 }
						}
						random_list = {
							70 = { custom_tooltip = { text = "siege_escaped" } }
							20 = { character_event = { id = Plus.1032 tooltip = "siege_injured" } }
							10 = { character_event = { id = Plus.1033 tooltip = "siege_sacrificed" } }
						}
					}
				}
			}
		}
		hidden_tooltip = {
			top_liege = {
				any_realm_character = {
					limit = { has_character_flag = wants_to_loot }
					clr_character_flag = wants_to_loot
				}
			}
		}
	}
}

# Character notified they were injured after a siege
character_event = {
	id = Plus.1032
	desc = "EVTDESC_Plus_1032"
	picture = "GFX_evt_bloody_man"
	border = "GFX_event_normal_frame_war"

	is_triggered_only = yes
	
	option = {
		name = "EVTOPTA_Plus_1032"
		random_list = {
			50 = {
				add_trait = wounded
			}
			30 = {
				health = -0.5
				if = {
					limit = { is_female = yes }
					random = {
						chance = 50
						add_trait = scarred_female
					}
				}
				if = {
					limit = { is_female = no }
					random = {
						chance = 50
						add_trait = scarred
					}
				}
				if = {
					limit = {
						is_female = yes
						is_adult = yes
						NOT = { age = 60 }
						NOT = { trait = syphilitic }
					}
					random = {
						chance = 30
						add_trait = syphilitic
					}
				}
				if = {
					limit = {
						is_female = yes
						is_adult = yes
						NOT = { age = 45 }
						fertility = 0.33
					}
					random = {
						chance = 30
						impregnate = 0
					}
				}
			}
			20 = {
				add_trait = maimed
			}
		}
	}
}

# Character notified that they were sacrificed at the siege
character_event = {
	id = Plus.1033
	desc = "EVTDESC_Plus_1033"
	picture = "GFX_evt_viking_battle_oldgods"
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTA_Plus_1026"
		death = {
			death_reason = death_sacrificed
			killer = FROM
		}
		hidden_tooltip = {
			ROOT = {
				if = {
					limit = {
						NOT = { mother = { character = FROM } }
					}
					mother = {
						opinion = {
							who = FROM
							modifier = executed_kin
							months = 120
						}
					}
				}
				if = {
					limit = {
						NOT = { father = { character = FROM } }
					}
					father = {
						opinion = {
							who = FROM
							modifier = executed_kin
							months = 120
						}
					}
				}
				any_sibling = {
					limit = {
						NOT = { character = FROM }
					}
					opinion = {
						who = FROM
						modifier = executed_kin
						months = 120
					}
				}
				any_child = {
					limit = {
						NOT = { character = FROM }
					}
					opinion = {
						who = FROM
						modifier = executed_kin
						months = 120
					}
				}
			}
		}
	}
}

